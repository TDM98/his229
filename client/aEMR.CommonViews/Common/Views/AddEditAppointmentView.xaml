<UserControl
    x:Class="aEMR.Common.Views.AddEditAppointmentView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Resources="clr-namespace:eHCMSLanguage;assembly=aEMRLanguage"
    xmlns:bindingContext="clr-namespace:aEMR.Common.Bindings;assembly=aEMR.Common"
    xmlns:cal="http://www.caliburnproject.org"
    xmlns:commonconverters="clr-namespace:aEMR.Common.Converters;assembly=aEMR.Common"
    xmlns:customcontrols="clr-namespace:aEMR.Controls;assembly=aEMR.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:multibinding="clr-namespace:aEMR.Common.Bindings;assembly=aEMR.Common"
    xmlns:my="clr-namespace:aEMR.CommonUserControls;assembly=aEMR.CommonUserControls"
    Width="900"
    d:DesignHeight="600"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.Resources>
        <Resources:eHCMSResources x:Key="eHCMSResources" />
        <commonconverters:DateTimeFromToConverter x:Key="DateTimeFromToConverter" />
        <BooleanToVisibilityConverter x:Key="BooleanToVisibility" />
        <commonconverters:BooleanToVisibilityNotConverter x:Key="BooleanToVisibilityNot" />
        <bindingContext:DataContextProxy x:Key="dataContextProxy" />
    </UserControl.Resources>


    <!--<toolkit:BusyIndicator HorizontalAlignment="Stretch"
                                         VerticalAlignment="Stretch"
                                         IsBusy="{Binding IsProcessing, Mode=OneWay}"
                                         DisplayAfter="0:0:0.100"
                                         Margin="0,0,0,10">
        <toolkit:BusyIndicator.BusyContent>
            <TextBlock Text="{Binding Path=StatusText, Mode=OneWay}"
                           FontSize="14"
                           FontWeight="Bold" />
        </toolkit:BusyIndicator.BusyContent>-->
    <Grid x:Name="LayoutRoot" Margin="2">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="70" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>
        <StackPanel Orientation="Vertical">
            <TextBlock
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Style="{StaticResource MainFrame.TextBlock.Header.01}"
                Text="{Binding T1462_G1_HBenhBNThongThuong, Source={StaticResource eHCMSResources}}"
                Visibility="{Binding CurrentAppointment.isHIAppt, Converter={StaticResource BooleanToVisibilityNot}}" />
            <TextBlock
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Foreground="Crimson"
                Style="{StaticResource MainFrame.TextBlock.Header.01}"
                Text="{Binding Z0042_G1_HBBNCoBHGCV, Source={StaticResource eHCMSResources}}"
                Visibility="{Binding CurrentAppointment.isHIAppt, Converter={StaticResource BooleanToVisibility}}" />
            <Button
                x:Name="EditGeneralInfoCmd"
                Grid.Row="0"
                Grid.Column="1"
                Grid.ColumnSpan="2"
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                Content="{Binding T2519_G1_KTraTTinBHcuaBN, Source={StaticResource eHCMSResources}}"
                Style="{StaticResource MainFrame.HyperlinkButton.01}"
                Visibility="{Binding CurrentAppointment.isHIAppt, Converter={StaticResource BooleanToVisibility}}" />
        </StackPanel>
        <my:UCPatientInfoV3 Grid.Row="1" DataContext="{Binding CurrentPatient, Mode=OneWay}" />
        <ContentControl Grid.Row="2" IsEnabled="{Binding HasDone}">
            <Grid>
                <Border
                    x:Name="groupAppointment"
                    Margin="0,0,0,0"
                    Style="{StaticResource LightBlueBorderStyleNew}">

                    <StackPanel>
                        <TextBlock
                            Margin="0"
                            Foreground="#FF5E5E5E"
                            Style="{StaticResource TBlock.Heading.02}"
                            Text="{Binding TextBacSiDeXuat}"
                            TextWrapping="Wrap" />
                        <Grid Margin="0,0,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="160" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="87" />
                                <ColumnDefinition Width="538" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                VerticalAlignment="Center"
                                Style="{StaticResource TextBlock.Heading.04}"
                                Text="{Binding N0045_G1_Ng, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" />
                            <DatePicker
                                x:Name="dtpApptDate"
                                Grid.Column="1"
                                Width="150"
                                Height="22"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                cal:Message.Attach="[Event SelectedDateChanged]=[Action dtpApptDate_SelectedDateChanged($source,$eventArgs)]                                                     ;[Event CalendarClosed]=[Action dtpApptDate_CalendarClosed($source,$eventArgs)]"
                                SelectedDate="{Binding CurrentAppointment.ApptDate, Mode=TwoWay, NotifyOnValidationError=True}"
                                SelectedDateFormat="Short" />

                            <TextBlock
                                Grid.Column="2"
                                VerticalAlignment="Center"
                                Style="{StaticResource TextBlock.Heading.04}"
                                Text="{Binding G1691_G1_TThai, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" />
                            <!--<customcontrols:AxComboBox Grid.Column="3" IsEnabled="False"
                                               Width="200"
                                               HorizontalAlignment="Left" VerticalAlignment="Center"
                                               ItemsSource="{Binding AppointmentStatusList, Mode=OneWay}"
                                               DisplayMemberPath="ObjectValue"
                                               SelectedValuePath="LookupID"
                                               Height="22" Style="{StaticResource MainFrame.ComboBox}"
                                               SelectedValueEx="{Binding CurrentAppointment.V_ApptStatus,Mode=TwoWay}"/>-->

                            <TextBlock
                                Grid.Column="3"
                                VerticalAlignment="Center"
                                Style="{StaticResource TextBlock.Heading.04}"
                                Text="{Binding CurrentAppointment.ApptStatus.ObjectValue}" />
                            <StackPanel
                                Grid.Row="1"
                                Grid.Column="0"
                                Grid.ColumnSpan="5"
                                Width="auto"
                                Orientation="Horizontal"
                                Visibility="{Binding CurrentAppointment.isHIAppt, Converter={StaticResource BooleanToVisibility}}">
                                <TextBlock
                                    Grid.Column="3"
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Foreground="Crimson"
                                    Style="{StaticResource TextBlock.Heading.04}"
                                    Text="{Binding K1901_G1_ChoPhepSDGiayChVienLanKhamToi, StringFormat='{}{0}: ', Source={StaticResource eHCMSResources}}" />
                                <CheckBox
                                    Name="chkAllowPaperReferralUseNextConsult"
                                    Grid.Column="5"
                                    VerticalAlignment="Center"
                                    cal:Message.Attach="[Event Loaded] = [Action chkAllowPaperReferralUseNextConsult_Loaded($source, $eventArgs)];                                                                 [Event Unchecked] = [Action chkAllowPaperReferralUseNextConsult_UnCheck($source, $eventArgs)]"
                                    IsChecked="{Binding CurrentAppointment.AllowPaperReferralUseNextConsult, Mode=TwoWay}"
                                    IsThreeState="False"
                                    Style="{StaticResource MainFrame.Checkbox.Title1}" />
                                <Border
                                    x:Name="GroupShow"
                                    Margin="2"
                                    Background="White"
                                    Style="{StaticResource LightBlueBorderStyle}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock
                                            Margin="5,0,0,0"
                                            VerticalAlignment="Center"
                                            Foreground="Crimson"
                                            Style="{StaticResource TextBlock.Heading.04}"
                                            Text="{Binding T3693_G1_ManTinh2, StringFormat='{}{0}: ', Source={StaticResource eHCMSResources}}" />
                                        <CheckBox
                                            VerticalAlignment="Center"
                                            IsChecked="{Binding CurrentAppointment.HasChronicDisease, TargetNullValue=False, Mode=TwoWay}"
                                            IsEnabled="{Binding CurrentAppointment.AllowPaperReferralUseNextConsult, Mode=OneWay}"
                                            IsThreeState="False"
                                            Style="{StaticResource MainFrame.Checkbox.Title1}" />

                                        <TextBlock
                                            Margin="5,0,0,0"
                                            VerticalAlignment="Center"
                                            Foreground="Crimson"
                                            Style="{StaticResource TextBlock.Heading.04}"
                                            Text="{Binding K0832_G1_3Khac, StringFormat='{}{0}: ', Source={StaticResource eHCMSResources}}" />
                                        <TextBox
                                            Width="390"
                                            Margin="5,0,0,0"
                                            VerticalAlignment="Center"
                                            IsEnabled="{Binding CurrentAppointment.AllowPaperReferralUseNextConsult, Mode=OneWay}"
                                            Style="{StaticResource MainFrame.TextBox}"
                                            Text="{Binding CurrentAppointment.ReasonToAllowPaperReferral, Mode=TwoWay}" />
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                        </Grid>
                    </StackPanel>

                </Border>

            </Grid>

        </ContentControl>
        <StackPanel Grid.Row="3">

            <ContentControl x:Name="DetailCuocHenIsEnabled" IsEnabled="{Binding DetailCuocHenIsEnabled, Mode=OneWay}">
                <Border x:Name="groupAppointmentDetails" Style="{StaticResource LightBlueBorderStyleNew}">
                    <StackPanel>
                        <TextBlock
                            Margin="0"
                            Foreground="#FF5E5E5E"
                            Style="{StaticResource TBlock.Heading.02}"
                            Text="{Binding K1844_G1_CTietCHen, Source={StaticResource eHCMSResources}}"
                            TextWrapping="Wrap" />

                        <TabControl>
                            <TabItem Header="{Binding T2119_G1_KB, Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TabItem}">
                                <StackPanel>

                                    <DataGrid
                                        x:Name="gridAppointmentDetails"
                                        Height="150"
                                        AutoGenerateColumns="False"
                                        CanUserAddRows="False"
                                        ColumnHeaderStyle="{StaticResource MainFrame.DataGridColumnHeaderStyle}"
                                        HorizontalScrollBarVisibility="Auto"
                                        ItemsSource="{Binding CurrentAppointment.PatientApptServiceDetailList, Mode=OneWay}"
                                        RowHeaderStyle="{StaticResource MainFrame.DataGridRowHeaderStyle}"
                                        RowStyle="{StaticResource MainFrame.DataGridRowStyle.Normal}"
                                        Style="{StaticResource MainFrame.DataGridStyle}"
                                        VerticalScrollBarVisibility="Auto">
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn>
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal" Visibility="{Binding Source={StaticResource dataContextProxy}, Path=DataSource.HasDone, Converter={StaticResource BooleanToVisibility}}">
                                                            <Button
                                                                x:Name="hplDeleteApptService"
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                cal:Message.Attach="[Event Click]=[Action hplDeleteApptService_Click($datacontext)]"
                                                                ToolTipService.ToolTip="{Binding G2617_G1_Xoa, Source={StaticResource eHCMSResources}}">
                                                                <Image
                                                                    Width="13"
                                                                    Height="13"
                                                                    Opacity="1"
                                                                    Source="/aEMR.CommonViews;component/Assets/Images/Delete.png" />
                                                            </Button>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn
                                                Width="*"
                                                Binding="{Binding MedService.MedServiceName, Mode=OneWay}"
                                                Header="{Binding K3421_G1_DV, Source={StaticResource eHCMSResources}}"
                                                IsReadOnly="True" />
                                            <DataGridTextColumn
                                                MinWidth="130"
                                                Binding="{Binding AppointmentType.ObjectValue, Mode=OneWay}"
                                                Header="{Binding T2704_G1_LoaiCHen, Source={StaticResource eHCMSResources}}"
                                                IsReadOnly="True" />
                                            <DataGridTextColumn
                                                MinWidth="130"
                                                Binding="{Binding DeptLocation.Location.LocationName, Mode=OneWay}"
                                                Header="{Binding P0385_G1_Pg, Source={StaticResource eHCMSResources}}"
                                                IsReadOnly="True" />
                                            <!--<DataGridTemplateColumn Header="{Binding P0385_G1_Pg, Source={StaticResource eHCMSResources}}">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <TextBlock Text="{Binding DeptLocation.Location.LocationName}" VerticalAlignment="Center"></TextBlock>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>

                                                    <DataGridTemplateColumn.CellEditingTemplate>
                                                        <DataTemplate>
                                                            <StackPanel Orientation="Horizontal">
                                                                <customcontrols:AxComboBox
                                                Name="cboDeptLocationService" FontWeight="Normal" Foreground="Black"
                                                VerticalAlignment="Center"
                                                ItemsSource="{Binding DeptLocationList,Mode=OneWay}"
                                                DisplayMemberPath="Location.LocationName"
                                                SelectedValuePath="DeptLocationID"
                                                Style="{StaticResource MainFrame.ComboBox}"
                                                SelectedItemEx="{Binding DeptLocation,Mode=TwoWay}" MinWidth="90"
                                                cal:Message.Attach="[Event SelectionChanged]=[Action cboDeptLocationService_SelectionChanged($source,$eventArgs)]"/>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellEditingTemplate>
                                                </DataGridTemplateColumn>-->
                                            <DataGridTextColumn
                                                Binding="{Binding ApptTimeSegment.SegmentName, Mode=OneWay}"
                                                Header="{Binding G0420_G1_TGian, Source={StaticResource eHCMSResources}}"
                                                IsReadOnly="True" />
                                            <!--<DataGridTemplateColumn Header="{Binding G0420_G1_TGian, Source={StaticResource eHCMSResources}}">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <TextBlock Text="{Binding ApptTimeSegment.SegmentName}" VerticalAlignment="Center"></TextBlock>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>

                                                    <DataGridTemplateColumn.CellEditingTemplate>
                                                        <DataTemplate>
                                                            <StackPanel Orientation="Horizontal">
                                                                <customcontrols:AxComboBox
                                                Name="cboSegmentService" FontWeight="Normal" Foreground="Black"
                                                VerticalAlignment="Center"
                                                ItemsSource="{Binding ApptTimeSegmentList,Mode=OneWay}"
                                                DisplayMemberPath="SegmentName"
                                                Style="{StaticResource MainFrame.ComboBox}"
                                                SelectedValuePath="ConsultationTimeSegmentID"
                                                SelectedItemEx="{Binding ApptTimeSegment,Mode=TwoWay}" MinWidth="90"
                                                cal:Message.Attach="[Event SelectionChanged]=[Action cboSegmentService_SelectionChanged($source,$eventArgs)]"/>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellEditingTemplate>
                                                </DataGridTemplateColumn>-->
                                            <DataGridTemplateColumn Header="{Binding K1148_G1_BDKThuc, Source={StaticResource eHCMSResources}}" IsReadOnly="True">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock VerticalAlignment="Center">
                                                            <multibinding:BindingUtil.MultiBindings>
                                                                <multibinding:MultiBindings>
                                                                    <multibinding:MultiBinding Converter="{StaticResource DateTimeFromToConverter}" TargetProperty="Text">
                                                                        <multibinding:BindingCollection>
                                                                            <Binding Path="ApptTimeSegment.StartTime" />
                                                                            <Binding Path="ApptTimeSegment.EndTime" />
                                                                        </multibinding:BindingCollection>
                                                                    </multibinding:MultiBinding>
                                                                </multibinding:MultiBindings>
                                                            </multibinding:BindingUtil.MultiBindings>
                                                        </TextBlock>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn
                                                MinWidth="80"
                                                Binding="{Binding ServiceSeqNum, Mode=OneWay}"
                                                Header="{Binding K0758_G1_STT, Source={StaticResource eHCMSResources}}"
                                                IsReadOnly="True"
                                                Visibility="Collapsed" />
                                        </DataGrid.Columns>
                                    </DataGrid>

                                    <!--<Grid Visibility="{Binding HasDone,Converter={StaticResource BooleanToVisibility} }">-->
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition />
                                            <RowDefinition />
                                            <RowDefinition />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="20" />
                                            <ColumnDefinition Width="70" />
                                            <ColumnDefinition Width="2*" />
                                        </Grid.ColumnDefinitions>

                                        <Label
                                            Grid.Row="0"
                                            Grid.Column="0"
                                            HorizontalAlignment="Right"
                                            Content="{Binding T2704_G1_LoaiCHen, StringFormat='{}{0}: ', Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Label.00}" />
                                        <customcontrols:AxComboBox
                                            Grid.Column="1"
                                            HorizontalAlignment="Stretch"
                                            DisplayMemberPath="ObjectValue"
                                            ItemsSource="{Binding AppointmentTypeList, Mode=OneWay}"
                                            SelectedItemEx="{Binding AppointmentTypeSelected, Mode=TwoWay}"
                                            SelectedValuePath="LookupID"
                                            Style="{StaticResource MainFrame.ComboBox}" />


                                        <Label
                                            Grid.Row="1"
                                            Grid.Column="0"
                                            HorizontalAlignment="Right"
                                            Content="{Binding K3421_G1_DV, StringFormat='{}{0}: ', Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Label.00}" />
                                        <customcontrols:AxComboBox
                                            x:Name="cboSelectedService"
                                            Grid.Row="1"
                                            Grid.Column="1"
                                            HorizontalAlignment="Stretch"
                                            ItemsSource="{Binding MedicalServicesList, Mode=OneWay}"
                                            SelectedItemEx="{Binding MedicalServicesSelected, Mode=TwoWay, NotifyOnValidationError=True, ValidatesOnExceptions=True}"
                                            Style="{StaticResource MainFrame.ComboBox}" />
                                        <TextBlock
                                            Grid.Row="2"
                                            Margin="5,0,0,0"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Foreground="Crimson"
                                            Style="{StaticResource TextBlock.Heading.04}"
                                            Text="{Binding K1598_G1_CapCuuTk, StringFormat='{}{0}: ', Source={StaticResource eHCMSResources}}"
                                            Visibility="{Binding CanConfirmEmerInPtReExamApp, Converter={StaticResource BooleanToVisibility}}" />
                                        <CheckBox
                                            Grid.Row="2"
                                            Grid.Column="1"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            IsChecked="{Binding CurrentAppointment.IsEmergInPtReExamApp, Mode=TwoWay}"
                                            Style="{StaticResource MainFrame.Checkbox.Title1}"
                                            Visibility="{Binding CanConfirmEmerInPtReExamApp, Converter={StaticResource BooleanToVisibility}}" />
                                        <Label
                                            Grid.Row="0"
                                            Grid.Column="3"
                                            HorizontalAlignment="Right"
                                            Content="{Binding A0957_G1_Msg_Pg, Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Label.00}" />
                                        <customcontrols:AxComboBox
                                            x:Name="cboLocations"
                                            Grid.Row="0"
                                            Grid.Column="4"
                                            HorizontalAlignment="Stretch"
                                            DisplayMemberPath="Location.LocationName"
                                            ItemsSource="{Binding DeptLocationsList, Mode=OneWay}"
                                            SelectedItemEx="{Binding DeptLocationsSelected, Mode=TwoWay, NotifyOnValidationError=True, ValidatesOnExceptions=True}"
                                            Style="{StaticResource MainFrame.ComboBox}" />


                                        <Label
                                            Grid.Row="1"
                                            Grid.Column="3"
                                            HorizontalAlignment="Right"
                                            Content="{Binding G0420_G1_TGian, StringFormat='{}{0}: ', Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Label.00}" />
                                        <customcontrols:AxComboBox
                                            x:Name="cboSegments"
                                            Grid.Row="1"
                                            Grid.Column="4"
                                            ItemsSource="{Binding AppointmentSegmentsList, Mode=OneWay}"
                                            SelectedItemEx="{Binding AppointmentSegmentsSelected, Mode=TwoWay, NotifyOnValidationError=True, ValidatesOnExceptions=True}"
                                            SelectedValuePath="ConsultationTimeSegmentID"
                                            Style="{StaticResource MainFrame.ComboBox}">
                                            <customcontrols:AxComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="{Binding SegmentNameExt, Mode=OneWay}" />
                                                        <TextBlock Margin="5,0,5,0" Text="{Binding K0756_G1_CTieu, StringFormat='{}|{0}', Source={StaticResource eHCMSResources}}" />
                                                        <TextBlock
                                                            Width="30"
                                                            Foreground="Purple"
                                                            Text="{Binding ApptdayMaxNumConsultationAllowed, Mode=OneWay}" />
                                                        <TextBlock Margin="5,0,5,0" Text="{Binding K0757_G1_DaHen, StringFormat='{}|{0}', Source={StaticResource eHCMSResources}}" />
                                                        <TextBlock
                                                            Width="30"
                                                            Foreground="Red"
                                                            Text="{Binding NumberOfSeq, Mode=OneWay}" />
                                                        <TextBlock
                                                            Margin="5,0,5,0"
                                                            Text="{Binding K0758_G1_STT, StringFormat='{}|{0}', Source={StaticResource eHCMSResources}}"
                                                            Visibility="Collapsed" />
                                                        <TextBlock
                                                            Width="30"
                                                            Foreground="Blue"
                                                            Text="{Binding CurrentSeqNumber, Mode=OneWay}"
                                                            Visibility="Collapsed" />
                                                    </StackPanel>
                                                </DataTemplate>
                                            </customcontrols:AxComboBox.ItemTemplate>
                                        </customcontrols:AxComboBox>


                                        <StackPanel
                                            Grid.Row="2"
                                            Grid.Column="4"
                                            HorizontalAlignment="Right"
                                            Orientation="Horizontal">

                                            <StackPanel
                                                Grid.Row="2"
                                                Grid.Column="4"
                                                HorizontalAlignment="Right"
                                                Orientation="Horizontal">

                                                <StackPanel Visibility="{Binding mPrintHIAppointment_New, Converter={StaticResource BooleanToVisibility}}">
                                                    <!--  KMx: Phải để nút "In BHYT Mới" vào 1 StackPanel riêng vì nút này có đến 2 điều kiện Visibility (08/01/2016 17:03).  -->
                                                    <Button
                                                        x:Name="HIAppt_NewCmd"
                                                        Width="90"
                                                        Height="22"
                                                        Margin="0,0,10,0"
                                                        Content="{Binding T1898_G1_InBHYTMoi, Source={StaticResource eHCMSResources}}"
                                                        Style="{StaticResource MainFrame.Button}"
                                                        Visibility="{Binding CurrentAppointment.AllowPaperReferralUseNextConsult, Converter={StaticResource BooleanToVisibility}}" />

                                                </StackPanel>

                                                <!--<Button Content="{Binding T1896_G1_InBHYT, Source={StaticResource eHCMSResources}}" Width="90"
                                                            Margin="0,0,10,0"
                                                                Style="{StaticResource MainFrame.Button}"
                                                                Height="22"
                                                                x:Name="HIApptCmd" ClickMode="Hover"
                                                            cal:Message.Attach="[Event MouseLeftButtonDown]=[Action HIApptCmd_MouseLeftButtonDown($source,$eventArgs)]"
                                                            Visibility="{Binding CurrentAppointment.AllowPaperReferralUseNextConsult,Converter={StaticResource BooleanToVisibility} }"
                                                                IsEnabled="{Binding hasSaved,Mode=OneWay}" />-->

                                                <!--  KMx: Bỏ sự kiện click, nếu không thì "Lý do Khác" không binding được (30/08/2014 11:34).  -->
                                                <!--  KMx: Chuyển sang dùng nút In BHYT - Mới (25/03/2016 11:37)  -->
                                                <!--<Button Content="{Binding T1896_G1_InBHYT, Source={StaticResource eHCMSResources}}" Width="90"
                                                        Margin="0,0,10,0"
                                                            Style="{StaticResource MainFrame.Button}"
                                                            Height="22"
                                                            x:Name="HIApptCmd"
                                                        Visibility="{Binding CurrentAppointment.AllowPaperReferralUseNextConsult,Converter={StaticResource BooleanToVisibility} }"/>-->

                                                <Button
                                                    x:Name="btPrintKB"
                                                    Width="90"
                                                    Margin="0,3,10,0"
                                                    cal:Message.Attach="[Event MouseLeftButtonDown]=[Action btPrintKB_MouseLeftButtonDown($source,$eventArgs)]"
                                                    ClickMode="Hover"
                                                    Content="{Binding T1820_G1_In, Source={StaticResource eHCMSResources}}"
                                                    Style="{StaticResource MainFrame.Button}"
                                                    Visibility="{Binding CurrentAppointment.AllowPaperReferralUseNextConsult, Converter={StaticResource BooleanToVisibilityNot}}" />

                                            </StackPanel>

                                            <StackPanel
                                                Grid.Row="2"
                                                Grid.Column="4"
                                                HorizontalAlignment="Right"
                                                Orientation="Horizontal"
                                                Visibility="{Binding HasDone, Converter={StaticResource BooleanToVisibility}}">
                                                <Button
                                                    x:Name="btAddApptMedService_Cmd"
                                                    Width="110"
                                                    Margin="0,3,0,0"
                                                    Content="{Binding G0252_G1_ThemDV, Source={StaticResource eHCMSResources}}"
                                                    IsEnabled="{Binding IsCanEdit, Mode=OneWay}"
                                                    Style="{StaticResource MainFrame.Button}" />

                                            </StackPanel>

                                        </StackPanel>

                                    </Grid>
                                </StackPanel>
                            </TabItem>

                            <TabItem Header="{Binding K1549_G1_CLS, Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TabItem}">
                                <StackPanel>

                                    <DataGrid
                                        x:Name="dtgPatientApptPCLRequestsList"
                                        Height="120"
                                        AutoGenerateColumns="False"
                                        CanUserAddRows="False"
                                        ColumnHeaderStyle="{StaticResource MainFrame.DataGridColumnHeaderStyle}"
                                        HorizontalScrollBarVisibility="Auto"
                                        IsReadOnly="True"
                                        ItemsSource="{Binding CurrentAppointment.PatientApptPCLRequestsList, Mode=OneWay}"
                                        RowHeaderStyle="{StaticResource MainFrame.DataGridRowHeaderStyle}"
                                        RowStyle="{StaticResource MainFrame.DataGridRowStyle.Normal}"
                                        SelectedItem="{Binding SelectedApptPclRequest, Mode=TwoWay}"
                                        Style="{StaticResource MainFrame.DataGridStyle}"
                                        VerticalScrollBarVisibility="Auto">
                                        <DataGrid.Columns>

                                            <DataGridTemplateColumn>
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal" Visibility="{Binding Source={StaticResource dataContextProxy}, Path=DataSource.HasDone, Converter={StaticResource BooleanToVisibility}}">
                                                            <Button
                                                                x:Name="hplPCLReqDelete"
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                cal:Message.Attach="[Event Click]=[Action hplPCLReqDelete_Click($datacontext)]"
                                                                ToolTipService.ToolTip="{Binding G2617_G1_Xoa, Source={StaticResource eHCMSResources}}">
                                                                <Image
                                                                    Width="13"
                                                                    Height="13"
                                                                    Opacity="1"
                                                                    Source="/aEMR.CommonViews;component/Assets/Images/Delete.png" />
                                                            </Button>

                                                        </StackPanel>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn
                                                Width="*"
                                                Binding="{Binding PCLRequestNumID}"
                                                Header="{Binding S0680_G1_SoPh, Source={StaticResource eHCMSResources}}"
                                                IsReadOnly="True" />
                                        </DataGrid.Columns>
                                    </DataGrid>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>

                                        <!--  Col0  -->
                                        <!--  Col1  -->
                                        <Grid Grid.Column="1">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>
                                            <DataGrid
                                                x:Name="dtgList"
                                                Grid.Row="0"
                                                Width="Auto"
                                                Height="170"
                                                MinWidth="700"
                                                AutoGenerateColumns="False"
                                                CanUserAddRows="False"
                                                ColumnHeaderStyle="{StaticResource MainFrame.DataGridColumnHeaderStyle}"
                                                HeadersVisibility="All"
                                                HorizontalScrollBarVisibility="Auto"
                                                IsReadOnly="True"
                                                ItemsSource="{Binding FilteredCollection, Mode=OneWay}"
                                                RowHeaderStyle="{StaticResource MainFrame.DataGridRowHeaderStyle}"
                                                Style="{StaticResource MainFrame.DataGridStyle}"
                                                VerticalScrollBarVisibility="Auto">
                                                <DataGrid.Columns>

                                                    <!--<DataGridTemplateColumn>
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <StackPanel Orientation="Horizontal">

                                                                    <HyperlinkButton x:Name="hplDeleteDetailPCL" ToolTipService.ToolTip="{Binding G2617_G1_Xoa, Source={StaticResource eHCMSResources}}" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                                 cal:Message.Attach="[Event Click]=[Action hplDeleteDetailPCL_Click($datacontext)]">
                                                                        <HyperlinkButton.Content>
                                                                            <Image Source="/aEMR.CommonViews;component/Assets/Images/Delete.png" Height="13" Width="13" Opacity="1" />
                                                                        </HyperlinkButton.Content>
                                                                    </HyperlinkButton>

                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>-->

                                                    <DataGridTextColumn
                                                        MinWidth="80"
                                                        Binding="{Binding ObjPCLExamTypes.PCLExamTypeCode}"
                                                        Header="{Binding Z1878_G1_MaCLS, Source={StaticResource eHCMSResources}}"
                                                        IsReadOnly="True" />
                                                    <DataGridTextColumn
                                                        Width="*"
                                                        MinWidth="200"
                                                        Binding="{Binding ObjPCLExamTypes.PCLExamTypeName}"
                                                        Header="{Binding T0842_G1_TenCLS, Source={StaticResource eHCMSResources}}"
                                                        IsReadOnly="True" />
                                                    <DataGridTemplateColumn MinWidth="200" Header="{Binding P0385_G1_Pg, Source={StaticResource eHCMSResources}}">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <TextBlock VerticalAlignment="Center" Text="{Binding ObjDeptLocID.Location.LocationName}" />
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTextColumn
                                                        Width="Auto"
                                                        MinWidth="80"
                                                        Binding="{Binding ApptTimeSegment.SegmentName, Mode=OneWay}"
                                                        Header="{Binding G0420_G1_TGian, Source={StaticResource eHCMSResources}}" />
                                                    <DataGridTemplateColumn Width="Auto" Header="{Binding K1148_G1_BDKThuc, Source={StaticResource eHCMSResources}}">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <TextBlock VerticalAlignment="Center">
                                                                    <multibinding:BindingUtil.MultiBindings>
                                                                        <multibinding:MultiBindings>
                                                                            <multibinding:MultiBinding Converter="{StaticResource DateTimeFromToConverter}" TargetProperty="Text">
                                                                                <multibinding:BindingCollection>
                                                                                    <Binding Path="ApptTimeSegment.StartTime" />
                                                                                    <Binding Path="ApptTimeSegment.EndTime" />
                                                                                </multibinding:BindingCollection>
                                                                            </multibinding:MultiBinding>
                                                                        </multibinding:MultiBindings>
                                                                    </multibinding:BindingUtil.MultiBindings>
                                                                </TextBlock>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>

                                                    <!--<DataGridTextColumn Header="{Binding K0758_G1_STT, Source={StaticResource eHCMSResources}}"
                                                    Binding="{Binding ServiceSeqNum, Mode=OneWay}"
                                                    Width="50" />-->


                                                </DataGrid.Columns>
                                            </DataGrid>
                                            <StackPanel
                                                Grid.Row="1"
                                                HorizontalAlignment="Right"
                                                Orientation="Horizontal"
                                                Visibility="{Binding HasDone, Converter={StaticResource BooleanToVisibility}}">

                                                <Button
                                                    x:Name="btPrintTongHopXN"
                                                    Width="105"
                                                    Margin="0,3,10,0"
                                                    cal:Message.Attach="[Event MouseLeftButtonDown]=[Action btPrintTongHopXN_MouseLeftButtonDown($source,$eventArgs)]"
                                                    ClickMode="Hover"
                                                    Content="{Binding T1950_G1_InTHopXN, Source={StaticResource eHCMSResources}}"
                                                    Style="{StaticResource MainFrame.Button}" />

                                                <Button
                                                    x:Name="btPrintTongHopHA"
                                                    Width="105"
                                                    Margin="0,3,10,0"
                                                    cal:Message.Attach="[Event MouseLeftButtonDown]=[Action btPrintTongHopHA_MouseLeftButtonDown($source,$eventArgs)]"
                                                    ClickMode="Hover"
                                                    Content="{Binding T1949_G1_InTHopHA, Source={StaticResource eHCMSResources}}"
                                                    Style="{StaticResource MainFrame.Button}" />

                                                <Button
                                                    x:Name="btPrintCLS"
                                                    Width="90"
                                                    Margin="0,3,10,0"
                                                    cal:Message.Attach="[Event MouseLeftButtonDown]=[Action btPrintCLS_MouseLeftButtonDown($source,$eventArgs)]"
                                                    ClickMode="Hover"
                                                    Content="{Binding T1951_G1_InTungPh, Source={StaticResource eHCMSResources}}"
                                                    Style="{StaticResource MainFrame.Button}" />

                                                <Button
                                                    x:Name="EditApptPclRequestCmd"
                                                    Width="90"
                                                    Margin="0,0,10,0"
                                                    HorizontalAlignment="Right"
                                                    Content="{Binding S0740_G1_SuaPh, Source={StaticResource eHCMSResources}}"
                                                    IsEnabled="{Binding butCLS, Mode=OneWay}"
                                                    Style="{StaticResource MainFrame.Button}" />

                                                <Button
                                                    x:Name="AddApptPclCmd"
                                                    Width="Auto"
                                                    Margin="0,0,10,0"
                                                    HorizontalAlignment="Right"
                                                    Content="{Binding T0813_G1_TaoPhYCXNMoi, Source={StaticResource eHCMSResources}}"
                                                    IsEnabled="{Binding butCLS, Mode=OneWay}"
                                                    Style="{StaticResource MainFrame.Button}" />
                                                <Button
                                                    x:Name="AddApptPclImageCmd"
                                                    Width="Auto"
                                                    HorizontalAlignment="Right"
                                                    Content="{Binding T0812_G1_TaoPhYCHAMoi, Source={StaticResource eHCMSResources}}"
                                                    IsEnabled="{Binding butCLS, Mode=OneWay}"
                                                    Style="{StaticResource MainFrame.Button}" />
                                            </StackPanel>

                                        </Grid>
                                    </Grid>
                                </StackPanel>
                            </TabItem>
                        </TabControl>
                    </StackPanel>
                </Border>
            </ContentControl>
        </StackPanel>
        <StackPanel
            Grid.Row="4"
            HorizontalAlignment="Right"
            Orientation="Horizontal">

            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                <Button
                    x:Name="btnPrintAll_New"
                    Width="100"
                    Height="22"
                    Margin="0,0,10,0"
                    cal:Message.Attach="[Event MouseLeftButtonDown]=[Action btnPrintAll_New_MouseLeftButtonDown($source,$eventArgs)]"
                    ClickMode="Hover"
                    Content="{Binding T1938_G1_InTatCaMoi, Source={StaticResource eHCMSResources}}"
                    Style="{StaticResource MainFrame.Button}"
                    Visibility="{Binding mPrintHIAppointment_New, Converter={StaticResource BooleanToVisibility}}" />
                <!--  KMx: Chuyển sang dùng nút In Tất Cả - Mới (25/03/2016 11:38)  -->
                <!--<Button x:Name="btnPrintAll" Content="{Binding T1937_G1_InTatCa, Source={StaticResource eHCMSResources}}" Width="90" Height="22"  Margin="0,0,10,0" ClickMode="Hover"
                                                        cal:Message.Attach="[Event MouseLeftButtonDown]=[Action btnPrintAll_MouseLeftButtonDown($source,$eventArgs)]"
                                                Style="{StaticResource MainFrame.Button}"/>-->
                <Button
                    x:Name="btnPrintPCL"
                    Width="110"
                    Height="22"
                    Margin="0,0,10,0"
                    cal:Message.Attach="[Event MouseLeftButtonDown]=[Action btnPrintPCL_MouseLeftButtonDown($source,$eventArgs)]"
                    ClickMode="Hover"
                    Content="{Binding T1904_G1_InCLS, Source={StaticResource eHCMSResources}}"
                    Style="{StaticResource MainFrame.Button}" />

            </StackPanel>
            <StackPanel
                Grid.Row="4"
                HorizontalAlignment="Right"
                Orientation="Horizontal"
                Visibility="{Binding HasDone, Converter={StaticResource BooleanToVisibility}}">
                <Button
                    x:Name="SaveAppointmentCmd"
                    Width="90"
                    Height="22"
                    Margin="0,0,10,0"
                    Content="{Binding T3144_G1_LuuHen, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding IsCanEdit, Mode=OneWay}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="CancelAppointmentCmd"
                    Width="110"
                    Height="22"
                    Margin="0,0,10,0"
                    Content="{Binding K3735_G1_Dong, Source={StaticResource eHCMSResources}}"
                    Style="{StaticResource MainFrame.Button}" />
            </StackPanel>
        </StackPanel>
    </Grid>
    <!--</toolkit:BusyIndicator>-->
</UserControl>