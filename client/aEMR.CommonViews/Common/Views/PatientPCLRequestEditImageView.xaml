<UserControl
    x:Class="aEMR.ConsultantEPrescription.Views.PatientPCLRequestEditImageView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ControlsLibrary="clr-namespace:aEMR.Controls;assembly=aEMR.Controls"
    xmlns:Converters="clr-namespace:aEMR.Common.Converters;assembly=aEMR.Common"
    xmlns:Resources="clr-namespace:eHCMSLanguage;assembly=aEMRLanguage"
    xmlns:cal="http://www.caliburnproject.org"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:toolkit="http://schemas.xceed.com/wpf/xaml/toolkit"
    d:DesignHeight="600"
    d:DesignWidth="900"
    mc:Ignorable="d">
    <UserControl.Resources>
        <Resources:eHCMSResources x:Key="eHCMSResources" />
        <Converters:IntConverterMin1 x:Key="IntConverterMin1" />
        <Converters:DecimalConverter x:Key="DecimalConverter" />
        <Converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        <BooleanToVisibilityConverter x:Key="BooleanToVisibility" />
        <Converters:BooleanToVisibilityNotConverter x:Key="BooleanToVisibilityNot" />
        <Converters:LongToNotBooleanConverter2 x:Key="LongToNotBooleanConverter2" />
    </UserControl.Resources>
    <Grid x:Name="LayoutRoot">
        <ContentControl IsEnabled="{Binding FormIsEnabled, Mode=OneWay}">
            <toolkit:BusyIndicator BusyContent="{Binding DlgBusyContent}" IsBusy="{Binding DlgIsBusyFlag}">
                <Grid Margin="5" Background="White">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <ContentControl Grid.Row="0">
                            <Grid x:Name="FormInput">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <!--  PCL Form Info  -->
                                <Border
                                    x:Name="BorderCanvas"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    IsEnabled="{Binding FormInputIsEnabled, Mode=OneWay}"
                                    Style="{StaticResource LightBlueBorderStyle}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="90" />
                                            <ColumnDefinition />
                                            <ColumnDefinition Width="60" />
                                            <ColumnDefinition />
                                            <ColumnDefinition Width="15" />
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition />
                                            <ColumnDefinition Width="auto" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <Label
                                            Grid.Row="1"
                                            Grid.Column="5"
                                            HorizontalAlignment="Right"
                                            Content="{Binding P0360_G1_Ph, StringFormat='{}{0}: ', Source={StaticResource eHCMSResources}}"
                                            FontWeight="Bold"
                                            Foreground="Brown"
                                            Style="{StaticResource MainFrame.Label.00}" />
                                        <Label
                                            Grid.Row="1"
                                            Grid.Column="6"
                                            Content="{Binding CurrentPclRequest.PCLRequestNumID}"
                                            FontWeight="Bold"
                                            Foreground="Brown"
                                            Style="{StaticResource MainFrame.Label.00}" />

                                        <Line
                                            Grid.Column="0"
                                            Grid.ColumnSpan="5"
                                            Height="1"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Top"
                                            Fill="#FFF4F4F5"
                                            Stroke="#FFCCCCCC" />

                                        <Label
                                            Grid.Row="1"
                                            Grid.Column="0"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Content="{Binding K1746_G1_CDoan, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Label.01}" />
                                        <TextBox
                                            x:Name="txtDiagnosis"
                                            Grid.Row="1"
                                            Grid.Column="1"
                                            Grid.ColumnSpan="3"
                                            Height="auto"
                                            MaxHeight="350"
                                            Margin="0,0,0,0"
                                            Padding="5"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Center"
                                            FontWeight="Bold"
                                            Foreground="Red"
                                            IsEnabled="{Binding IsEnabledtxbDiagnosis}"
                                            Style="{StaticResource MainFrame.TextBox}"
                                            Text="{Binding CurrentPclRequest.Diagnosis, Mode=TwoWay}"
                                            TextWrapping="Wrap" />
                                        <Button
                                            Name="EnableTxbDiagnosis"
                                            Grid.Row="1"
                                            Grid.Column="4"
                                            Content="..."
                                            Style="{StaticResource MainFrame.Button}" 
                                            Visibility="Collapsed" />

                                        <!--  Line  -->
                                        <Line
                                            Grid.Row="2"
                                            Grid.Column="0"
                                            Grid.ColumnSpan="8"
                                            Height="1"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Top"
                                            Fill="#FFF4F4F5"
                                            Stroke="#FFCCCCCC" />
                                        <!--  Line  -->

                                        <Label
                                            Grid.Row="3"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Content="{Binding G2957_G1_YC, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Label.01}" />
                                        <TextBox
                                            x:Name="txtICD10List"
                                            Grid.Row="3"
                                            Grid.Column="1"
                                            Height="24"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Center"
                                            VerticalContentAlignment="Center"
                                            IsReadOnly="{Binding ReadOnly}"
                                            MaxLength="254"
                                            Text="{Binding CurrentPclRequest.ICD10List, Mode=TwoWay}"
                                            TextWrapping="Wrap" 
                                            IsEnabled="False"
                                            Padding="3,2,0,0"/>

                                        <Label
                                            Grid.Row="3"
                                            Grid.Column="2"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Content="{Binding G2957_G1_YC, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Label.01}" />
                                        <TextBox
                                            x:Name="txtComment"
                                            Grid.Row="3"
                                            Grid.Column="3"
                                            Height="Auto"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Center"
                                            IsReadOnly="{Binding ReadOnly}"
                                            MaxLength="254"
                                            Text="{Binding DoctorComments, Mode=TwoWay}"
                                            TextWrapping="Wrap" />
                                        <!--  KMx: Sử dụng nút "Đồng ý" thay cho nút "Cập nhật yêu cầu" và "Cập nhật lời dặn"  -->
                                        <!--<Button x:Name="btUpdateInfo" Content="{Binding K1599_G1_CNhat, Source={StaticResource eHCMSResources}}" Grid.Column="4" Grid.ColumnSpan="3" Grid.Row="3" Width="70" Style="{StaticResource MainFrame.Button}"
                                            IsEnabled="{Binding btSaveIsEnabled, Mode=OneWay}" Margin="2,0,0,0" HorizontalAlignment="Left"
                                            />-->
                                        <!--  Line  -->
                                        <Line
                                            Grid.Row="4"
                                            Grid.Column="0"
                                            Grid.ColumnSpan="8"
                                            Height="1"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Top"
                                            Fill="#FFF4F4F5"
                                            Stroke="#FFCCCCCC" />
                                        <!--  Line  -->
                                        <Label
                                            Grid.Row="6"
                                            Grid.Column="0"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Content="{Binding T2799_G1_LoaiPCLForm, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Label.01}">
                                            <ToolTipService.ToolTip>
                                                <ToolTip
                                                    Content="{Binding K1945_G1_ChonFormCLS, Source={StaticResource eHCMSResources}}"
                                                    HorizontalOffset="10"
                                                    VerticalOffset="10" />
                                            </ToolTipService.ToolTip>
                                        </Label>
                                        <ControlsLibrary:AxComboBox
                                            x:Name="cboV_PCLMainCategory"
                                            Grid.Row="6"
                                            Grid.Column="1"
                                            Grid.ColumnSpan="3"
                                            Height="22"
                                            VerticalAlignment="Top"
                                            DisplayMemberPath="ObjectValue"
                                            ItemsSource="{Binding ObjV_PCLMainCategory, Mode=OneWay}"
                                            SelectedItemEx="{Binding ObjV_PCLMainCategory_Selected, Mode=TwoWay}"
                                            SelectedValuePath="LookupID"
                                            Style="{StaticResource MainFrame.ComboBox}" />


                                        <Label
                                            Grid.Row="6"
                                            Grid.Column="5"
                                            HorizontalAlignment="Right"
                                            Content="{Binding K2088_G1_ChonPCLForm2, StringFormat='{}{0}: ', Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Label.00}" />

                                        <ControlsLibrary:AxComboBox
                                            Name="cboPCLForm"
                                            Grid.Row="6"
                                            Grid.Column="6"
                                            Height="22"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Center"
                                            cal:Message.Attach="[Event SelectionChanged]=[Action cboPCLForm_SelectionChanged($source,$eventArgs)]"
                                            DisplayMemberPath="PCLFormName"
                                            IsEnabled="{Binding cboPCLFormIsEnabled}"
                                            ItemsSource="{Binding ObjPCLForms_GetList, Mode=OneWay}"
                                            SelectedItemEx="{Binding ObjPCLForms_GetList_Selected, Mode=TwoWay}"
                                            SelectedValuePath="PCLFormID"
                                            Style="{StaticResource MainFrame.ComboBox}"
                                            Visibility="{Binding VisibilityFrom}" />
                                        <Line
                                            Grid.Row="7"
                                            Grid.ColumnSpan="7"
                                            Height="1"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Top"
                                            Fill="#FFF4F4F5"
                                            Stroke="#FFCCCCCC" />
                                        <Label
                                            Grid.Row="7"
                                            Grid.Column="0"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Content="{Binding R0012_G1_BSiCDinh, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Label.01}">
                                            <ToolTipService.ToolTip>
                                                <ToolTip
                                                    Content="{Binding K1945_G1_ChonFormCLS, Source={StaticResource eHCMSResources}}"
                                                    HorizontalOffset="10"
                                                    VerticalOffset="10" />
                                            </ToolTipService.ToolTip>
                                        </Label>
                                        <ControlsLibrary:AxAutoComplete
                                            Grid.Row="7"
                                            Grid.Column="1"
                                            Grid.ColumnSpan="3"
                                            Width="Auto"
                                            Height="22"
                                            HorizontalAlignment="Stretch"
                                            cal:Message.Attach="[Event Populating]=[Action DoctorStaff_Populating($source,$eventArgs)]                                                                         ;[Event DropDownClosed]=[Action DoctorStaff_DropDownClosed($source,$eventArgs)]"
                                            FilterMode="None"
                                            IsDropDownOpen="True"
                                            IsEnabled="{Binding CurrentPclRequest.IntPtDiagDrInstructionID, Converter={StaticResource LongToNotBooleanConverter2}}"
                                            ItemContainerStyle="{StaticResource AxAutoCompleteBoxBkg}"
                                            MinimumPopulateDelay="300"
                                            MinimumPrefixLength="0"
                                            SelectedItem="{Binding gSelectedDoctorStaff, Mode=TwoWay}"
                                            Style="{StaticResource AxAutoCompleteMyStyle}"
                                            Text="{Binding gSelectedDoctorStaff.FullName}"
                                            ValueMemberBinding="{Binding FullName, Mode=TwoWay}"
                                            ValueMemberPath="FullName">
                                            <ControlsLibrary:AxAutoComplete.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel>
                                                        <TextBlock
                                                            Margin="0"
                                                            Padding="0"
                                                            Style="{StaticResource MainFrame.TextBlock.01}"
                                                            Text="{Binding FullName}" />
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ControlsLibrary:AxAutoComplete.ItemTemplate>
                                        </ControlsLibrary:AxAutoComplete>
                                        <Label
                                            Grid.Row="7"
                                            Grid.Column="5"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Content="{Binding N0133_G1_NgYLenh, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Label.01}">
                                            <ToolTipService.ToolTip>
                                                <ToolTip
                                                    Content="{Binding K1945_G1_ChonFormCLS, Source={StaticResource eHCMSResources}}"
                                                    HorizontalOffset="10"
                                                    VerticalOffset="10" />
                                            </ToolTipService.ToolTip>
                                        </Label>
                                        <!--<DatePicker Height="22" Grid.Row="7" Grid.Column="6" SelectedDate="{Binding gMedicalInstructionDate,TargetNullValue=null, Mode=TwoWay}" Style="{StaticResource MainFrame.DatePicker}" HorizontalAlignment="Left"
                                        IsEnabled="{Binding IsEnableMedicalInstructionDate, Mode=OneWay}"
                                                        cal:Message.Attach="[Event LostFocus]=[Action InstructionDate_LostFocus($source,$eventArgs)]" />-->

                                        <ContentControl
                                            x:Name="MedicalInstructionDateContent"
                                            Grid.Row="7"
                                            Grid.Column="6"
                                            Height="20"
                                            Margin="1,2,1,2"
                                            HorizontalAlignment="Left"
                                            IsEnabled="{Binding IsEnableMedicalInstructionDate, Mode=OneWay}" />
                                    </Grid>
                                </Border>

                                <Grid Grid.Row="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="30" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <Grid
                                        Grid.Column="0"
                                        HorizontalAlignment="Stretch"
                                        IsEnabled="{Binding FormInputIsEnabled, Mode=OneWay}">
                                        <!--  Tìm theo Form  -->
                                        <Grid x:Name="SPTheoForm" Visibility="{Binding SPTheoFormVisibility, Converter={StaticResource BooleanToVisibility}}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="50" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="27" />
                                                <RowDefinition Height="35" />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>

                                            <Label
                                                Grid.Row="0"
                                                Grid.ColumnSpan="2"
                                                Content="{Binding K2026_G1_ChonLoaiCLSHaDbClkHoacNhanNutDeChon, Source={StaticResource eHCMSResources}}"
                                                Foreground="DarkCyan"
                                                Style="{StaticResource MainFrame.Label.00}" />
                                            <ContentControl
                                                Name="SPTheoAutoComplete"
                                                Grid.Row="1"
                                                Grid.Column="0"
                                                Grid.ColumnSpan="2"
                                                Height="35"
                                                MaxHeight="300"
                                                HorizontalContentAlignment="Stretch"
                                                VerticalContentAlignment="Stretch"
                                                Visibility="{Binding SPTheoAutoCompleteVisibility, Converter={StaticResource BooleanToVisibility}}" />
                                            <ControlsLibrary:ReadOnlyDataGrid
                                                Name="dtgList"
                                                Grid.Row="2"
                                                Grid.ColumnSpan="2"
                                                MinHeight="300"
                                                MaxHeight="400"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"
                                                cal:Message.Attach="[Event LoadingRow]=[Action dtgList_LoadingRow($source,$eventArgs)]                                                                               ;[Event DblClick]=[Action DoubleClick($eventArgs)]"
                                                AutoGenerateColumns="False"
                                                CanUserReorderColumns="True"
                                                CanUserResizeColumns="True"
                                                CanUserSortColumns="True"
                                                ColumnHeaderStyle="{StaticResource MainFrame.DataGridColumnHeaderStyle}"
                                                HeadersVisibility="All"
                                                ItemsSource="{Binding ObjPCLItems_ByPCLFormID, Mode=TwoWay}"
                                                RowHeaderStyle="{StaticResource MainFrame.DataGridRowHeaderStyle}"
                                                RowStyle="{StaticResource MainFrame.DataGridRowStyle.Normal}"
                                                ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                                ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                SelectedItem="{Binding SelectedItemForChoose, Mode=TwoWay}"
                                                Style="{StaticResource MainFrame.DataGridStyle}">
                                                <!--<DataGrid.RowGroupHeaderStyles>
                                                -->
                                                <!--  Style for groups at top level  -->
                                                <!--
                                                    <Style TargetType="DataGridRowGroupHeader">
                                                        <Setter Property="PropertyNameVisibility" Value="Collapsed" />
                                                        <Setter Property="Background" Value="#FFC7C7D1" />
                                                        <Setter Property="Foreground" Value="#FF444D58" />
                                                        <Setter Property="FontWeight" Value="Bold" />
                                                        <Setter Property="Height" Value="25" />
                                                        <Setter Property="SublevelIndent" Value="0" />
                                                    </Style>
                                                -->
                                                <!--  Style for groups under the top level  -->
                                                <!--
                                                    <Style TargetType="DataGridRowGroupHeader">
                                                        <Setter Property="Background" Value="#FFA8B5BE" />
                                                    </Style>
                                                </DataGrid.RowGroupHeaderStyles>-->
                                                <DataGrid.Columns>
                                                    <!--<DataGridTextColumn Header="{Binding T3185_G1_Ma, Source={StaticResource eHCMSResources}}" Width="60"
                                                    Binding="{Binding PCLExamTypeCode}"></DataGridTextColumn>-->

                                                    <DataGridTextColumn
                                                        Width="Auto"
                                                        Binding="{Binding PCLExamTypeName}"
                                                        Header="{Binding T2860_G1_LoaiXN, Source={StaticResource eHCMSResources}}" />
                                                    <DataGridTemplateColumn Header="{Binding S0583_G1_SLg, Source={StaticResource eHCMSResources}}">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <TextBox Text="{Binding Qty, Mode=TwoWay, UpdateSourceTrigger=LostFocus}" TextAlignment="Right" />
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTemplateColumn Header="{Binding T1009_G1_GiaDV, Source={StaticResource eHCMSResources}}" IsReadOnly="True">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <TextBox
                                                                    Width="60"
                                                                    Background="#F0F0F0"
                                                                    IsReadOnly="True"
                                                                    Text="{Binding NormalPrice, Mode=TwoWay, Converter={StaticResource DecimalConverter}}"
                                                                    TextAlignment="Right" />
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTemplateColumn Header="{Binding T0906_G1_GiaBHQDinh, Source={StaticResource eHCMSResources}}" IsReadOnly="True">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <TextBox
                                                                    Width="60"
                                                                    Background="#F0F0F0"
                                                                    IsReadOnly="True"
                                                                    Text="{Binding HIAllowedPrice, Mode=TwoWay, Converter={StaticResource DecimalConverter}}"
                                                                    TextAlignment="Right" />
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                </DataGrid.Columns>
                                            </ControlsLibrary:ReadOnlyDataGrid>
                                        </Grid>
                                        <!--  /Tìm theo Form  -->

                                        <!--  Tìm theo AutoComplete  -->

                                        <!--<ContentControl Name="SPTheoAutoComplete" Visibility="{Binding SPTheoAutoCompleteVisibility,Converter={StaticResource BooleanToVisibility}}"
                                            HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" MaxHeight="300" />-->
                                        <!--  Tìm theo AutoComplete  -->
                                    </Grid>

                                    <Grid Grid.Column="1" IsEnabled="{Binding FormInputIsEnabled, Mode=OneWay}">
                                        <StackPanel
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Top"
                                            Orientation="Vertical">
                                            <!--  Visibility="{Binding mPCL_XemSuaPhieuYeuCau_ChinhSua, Mode=TwoWay,Converter={StaticResource BooleanToVisibility}}"  -->
                                            <Button
                                                x:Name="btAdd"
                                                Margin="0,50,0,0"
                                                VerticalAlignment="Top"
                                                Content="&#45;&gt;"
                                                Style="{StaticResource MainFrame.Button}" />
                                            <!--  Visibility="{Binding mPCL_XemSuaPhieuYeuCau_ChinhSua, Mode=TwoWay,Converter={StaticResource BooleanToVisibility}}"  -->
                                            <Button
                                                x:Name="btAddAll"
                                                Margin="0,10,0,0"
                                                Content="&#45;&gt;&gt;"
                                                IsEnabled="{Binding OneClick, Mode=OneWay}"
                                                Style="{StaticResource MainFrame.Button}" />
                                            <!--  Visibility="{Binding mPCL_XemSuaPhieuYeuCau_ChinhSua, Mode=TwoWay,Converter={StaticResource BooleanToVisibility}}"  -->
                                            <Button
                                                x:Name="btSubtractAll"
                                                Margin="0,10,0,0"
                                                Content="&lt;&lt;&#45;"
                                                Style="{StaticResource MainFrame.Button}" />
                                        </StackPanel>
                                    </Grid>

                                    <Grid Grid.Column="2" Visibility="{Binding IsAppointment, Mode=OneWay, Converter={StaticResource BooleanToVisibilityNot}}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="27" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <ContentControl
                                            x:Name="PCLRequestDetailsContent"
                                            Grid.Row="1"
                                            HorizontalContentAlignment="Stretch"
                                            VerticalContentAlignment="Stretch" />

                                    </Grid>
                                    <Grid Grid.Column="2" Visibility="{Binding IsAppointment, Mode=OneWay, Converter={StaticResource BooleanToVisibility}}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="30" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <Label
                                            Grid.Row="0"
                                            Content="{Binding K2389_G1_CLSHADaChon, Source={StaticResource eHCMSResources}}"
                                            Foreground="DarkCyan"
                                            Style="{StaticResource MainFrame.Label.00}" />

                                        <ContentControl
                                            x:Name="pclApptRequestDetailsContent"
                                            Grid.Row="1"
                                            HorizontalContentAlignment="Stretch"
                                            VerticalContentAlignment="Stretch" />
                                    </Grid>
                                </Grid>

                                <Border
                                    x:Name="BorderCalculating"
                                    Grid.Row="2"
                                    Width="Auto"
                                    Margin="1,2,1,1"
                                    Style="{StaticResource LightBlueBorderStyle}"
                                    Visibility="{Binding IsAppointment, Converter={StaticResource BooleanToVisibilityNot}}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="851" />
                                            <ColumnDefinition Width="30" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Orientation="Horizontal">
                                            <Label
                                                Grid.Row="0"
                                                Grid.Column="4"
                                                Margin="10,0,0,0"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center"
                                                Content="{Binding G1592_G1_TgTienDV, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}"
                                                Style="{StaticResource MainFrame.Label.01}" />
                                            <TextBlock
                                                Grid.Row="0"
                                                Grid.Column="5"
                                                Margin="10,0,0,0"
                                                VerticalAlignment="Center"
                                                FontWeight="Bold"
                                                Foreground="Red"
                                                Text="{Binding Sum_NormalPrice, Mode=TwoWay, Converter={StaticResource DecimalConverter}}"
                                                TextAlignment="Right" />

                                            <Label
                                                Grid.Row="1"
                                                Grid.Column="4"
                                                Margin="10,0,0,0"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center"
                                                Content="{Binding G1582_G1_TgTienBhQDinh, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}"
                                                Style="{StaticResource MainFrame.Label.01}" />
                                            <TextBlock
                                                Grid.Row="1"
                                                Grid.Column="5"
                                                Margin="10,0,0,0"
                                                VerticalAlignment="Center"
                                                Foreground="Red"
                                                Text="{Binding Sum_HIAllowedPrice, Mode=TwoWay, Converter={StaticResource DecimalConverter}}"
                                                TextAlignment="Right" />
                                            <Label
                                                Grid.Row="2"
                                                Grid.Column="4"
                                                Margin="10,0,0,0"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center"
                                                Content="{Binding G1587_G1_TgTienChenhLech, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}"
                                                Style="{StaticResource MainFrame.Label.01}" />
                                            <TextBlock
                                                Grid.Row="2"
                                                Grid.Column="5"
                                                Margin="10,0,0,0"
                                                VerticalAlignment="Center"
                                                Foreground="Red"
                                                Text="{Binding Sum_PriceDifference, Mode=TwoWay, Converter={StaticResource DecimalConverter}}"
                                                TextAlignment="Right" />
                                            <CheckBox
                                                Margin="20,0,0,0"
                                                VerticalAlignment="Center"
                                                VerticalContentAlignment="Center"
                                                Content="{Binding Z2362_G1_TraSau, Source={StaticResource eHCMSResources}}"
                                                IsChecked="{Binding CurrentPclRequest.AllowToPayAfter, Mode=TwoWay}"
                                                IsEnabled="{Binding CurrentPclRequest.IsPaid, Converter={StaticResource InverseBoolConverter}}"
                                                Style="{StaticResource MainFrame.Checkbox}"
                                                Visibility="{Binding IsShowCheckBoxPayAfter, Converter={StaticResource BooleanToVisibility}}" />
                                            <CheckBox
                                                Margin="20,0,0,0"
                                                VerticalAlignment="Center"
                                                VerticalContentAlignment="Center"
                                                Content="{Binding Z2693_G1_TimDVTheoPhacDo, Source={StaticResource eHCMSResources}}"
                                                IsChecked="{Binding IsRegimenChecked, Mode=TwoWay}"
                                                Style="{StaticResource MainFrame.Checkbox}" />
                                            <CheckBox
                                                Margin="20,0,0,0"
                                                VerticalAlignment="Center"
                                                VerticalContentAlignment="Center"
                                                Content="{Binding Z2762_G1_DaTaoRISWorkList, Source={StaticResource eHCMSResources}}"
                                                IsChecked="{Binding CurrentPclRequest.IsTransferredToRIS, Mode=OneWay}"
                                                IsEnabled="False"
                                                Style="{StaticResource MainFrame.Checkbox}"
                                                Visibility="{Binding AutoCreateRISWorklist, Converter={StaticResource BooleanToVisibility}}" />
                                            <CheckBox
                                                Margin="20,0,0,0"
                                                VerticalAlignment="Center"
                                                VerticalContentAlignment="Center"
                                                Content="{Binding Z3085_G1_DaTaoPACWorkList, Source={StaticResource eHCMSResources}}"
                                                IsChecked="{Binding CurrentPclRequest.IsTransferredToRIS, Mode=OneWay}"
                                                IsEnabled="False"
                                                Style="{StaticResource MainFrame.Checkbox}"
                                                Visibility="{Binding AutoCreatePACWorklist, Converter={StaticResource BooleanToVisibility}}" />
                                        </StackPanel>
                                    </Grid>

                                </Border>

                            </Grid>
                        </ContentControl>

                        <Grid Grid.Row="1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="auto" />
                                    <ColumnDefinition Width="Auto" />

                                </Grid.ColumnDefinitions>
                                <StackPanel
                                    Grid.Column="0"
                                    VerticalAlignment="Center"
                                    Orientation="Horizontal"
                                    Visibility="{Binding IsAppointment, Converter={StaticResource BooleanToVisibility}}">

                                    <Grid
                                        Grid.Row="4"
                                        Grid.ColumnSpan="7"
                                        Width="Auto"
                                        Height="auto"
                                        ShowGridLines="False">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="130" />
                                            <ColumnDefinition Width="5" />
                                            <ColumnDefinition Width="100*" />

                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="3*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock
                                            Grid.Row="0"
                                            Grid.Column="0"
                                            Margin="0,2,0,0"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            Style="{StaticResource TextBlock.Heading.04}"
                                            Text="{Binding K2039_G1_ChonLoiDanTuMau2, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" />
                                        <ControlsLibrary:KeyEnabledComboBox
                                            Name="cbNoteTemplates"
                                            Grid.Row="1"
                                            Grid.Column="0"
                                            DisplayMemberPath="NoteDetailsShortWithID"
                                            IsEnabled="{Binding IsEnabled}"
                                            ItemsSource="{Binding allPrescriptionNoteTemplates, Mode=TwoWay}"
                                            SelectedItemEx="{Binding curPrescriptionNoteTemplates, Mode=TwoWay}"
                                            SelectedValuePath="PrescriptNoteTemplateID"
                                            Style="{StaticResource MainFrame.ComboBox}" />


                                        <ControlsLibrary:AxTextBox
                                            Name="txtDrAdvice"
                                            Grid.Row="0"
                                            Grid.RowSpan="4"
                                            Grid.Column="2"
                                            Width="auto"
                                            Height="70"
                                            MinWidth="350"
                                            Margin="1,2,0,0"
                                            AcceptsReturn="True"
                                            HorizontalScrollBarVisibility="Auto"
                                            IsEnabled="{Binding IsEnabled}"
                                            MaxLength="1024"
                                            Style="{StaticResource MainFrame.TextBox}"
                                            TabIndex="2"
                                            Text="{Binding EditingApptPCLRequest.ApptPCLNote, Mode=TwoWay}"
                                            VerticalScrollBarVisibility="Auto" />
                                        <!--  KMx: Sử dụng nút "Đồng ý" thay cho nút "Cập nhật yêu cầu" và "Cập nhật lời dặn"  -->
                                        <!--<Button x:Name="btUpdatePCLTemplate" Grid.Column="0" Grid.Row="2"
                                            Width="120"
                                            HorizontalAlignment="Center"
                                            Content="{Binding K1661_G1_CNhatLoiDan, Source={StaticResource eHCMSResources}}"
                                            IsEnabled="{Binding btnUpdateIsEnabled, Mode=OneWay}"
                                            Style="{StaticResource MainFrame.Button}"
                                            Visibility="{Binding IsEdit,Converter={StaticResource BooleanToVisibility} }" />-->
                                    </Grid>
                                </StackPanel>

                                <StackPanel
                                    Grid.Column="1"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Orientation="Vertical">
                                    <StackPanel
                                        VerticalAlignment="Center"
                                        Orientation="Horizontal"
                                        Visibility="{Binding IsAppointment, Converter={StaticResource BooleanToVisibilityNot}}">
                                        <Button
                                            x:Name="btNew"
                                            Width="70"
                                            Content="{Binding T0795_G1_TaoMoi, Source={StaticResource eHCMSResources}}"
                                            IsEnabled="{Binding btNewIsEnabled, Mode=OneWay}"
                                            Style="{StaticResource MainFrame.Button}"
                                            Visibility="{Binding mPCL_TaoPhieuMoi_Them, Mode=TwoWay, Converter={StaticResource BooleanToVisibility}}" />
                                        <Button
                                            x:Name="btEdit"
                                            Width="70"
                                            Content="{Binding T1484_G1_HChinh, Source={StaticResource eHCMSResources}}"
                                            IsEnabled="{Binding btEditIsEnabled, Mode=OneWay}"
                                            Style="{StaticResource MainFrame.Button}"
                                            Visibility="Collapsed" />
                                        <!--  Visibility="{Binding mPCL_XemSuaPhieuYeuCau_ChinhSua, Mode=TwoWay,Converter={StaticResource BooleanToVisibility}}"  -->
                                        <!--  20190403 TBL: Do phiếu chỉ định CDHA khi có 2 dịch vụ trong cùng 1 phiếu sẽ được tách ra làm 2 phiếu nên khi hiệu chỉnh sẽ không tự động tách nữa  -->
                                        <Button
                                            x:Name="btDelete"
                                            Width="90"
                                            Content="{Binding T1740_G1_HuyBoPh, Source={StaticResource eHCMSResources}}"
                                            IsEnabled="{Binding btXoaIsEnabled, Mode=OneWay}"
                                            Style="{StaticResource MainFrame.Button}"
                                            Visibility="{Binding mPCL_XemSuaPhieuYeuCau_Huy, Mode=TwoWay, Converter={StaticResource BooleanToVisibility}}" />
                                        <Button
                                            x:Name="btSave"
                                            Width="70"
                                            Content="{Binding T2937_G1_Luu, Source={StaticResource eHCMSResources}}"
                                            IsEnabled="{Binding btSaveIsEnabled, Mode=OneWay}"
                                            Style="{StaticResource MainFrame.Button}"
                                            Visibility="{Binding mPCL_XemSuaPhieuYeuCau_ChinhSua, Mode=TwoWay, Converter={StaticResource BooleanToVisibility}}" />
                                        <Button
                                            x:Name="btCancel"
                                            Width="70"
                                            Content="{Binding K1305_G1_BoQua, Source={StaticResource eHCMSResources}}"
                                            IsEnabled="{Binding btCancelIsEnabled, Mode=OneWay}"
                                            Style="{StaticResource MainFrame.Button}" />
                                        <Button
                                            x:Name="btPreviewPrint"
                                            Width="70"
                                            Content="{Binding G2521_G1_XemIn, Source={StaticResource eHCMSResources}}"
                                            IsEnabled="{Binding btInIsEnabled, Mode=OneWay}"
                                            Style="{StaticResource MainFrame.Button}"
                                            Visibility="{Binding mPCL_XemSuaPhieuYeuCau_XemIn, Mode=TwoWay, Converter={StaticResource BooleanToVisibility}}" />
                                        <Button
                                            x:Name="btPrintTongHopHA"
                                            Width="80"
                                            cal:Message.Attach="[Event MouseLeftButtonDown]=[Action btPrintTongHopHA_MouseLeftButtonDown($source,$eventArgs)]"
                                            ClickMode="Hover"
                                            Content="{Binding T1948_G1_InTHop, Source={StaticResource eHCMSResources}}"
                                            IsEnabled="{Binding btInIsEnabled, Mode=OneWay}"
                                            Style="{StaticResource MainFrame.Button}"
                                            Visibility="{Binding mPCL_XemSuaPhieuYeuCau_XemIn, Mode=TwoWay, Converter={StaticResource BooleanToVisibility}}" />
                                        <Button
                                            x:Name="btPrint"
                                            Width="70"
                                            Content="{Binding T1820_G1_In, Source={StaticResource eHCMSResources}}"
                                            IsEnabled="{Binding btInIsEnabled, Mode=OneWay}"
                                            Style="{StaticResource MainFrame.Button}"
                                            Visibility="{Binding mPCL_XemSuaPhieuYeuCau_In, Mode=TwoWay, Converter={StaticResource BooleanToVisibility}}" />
                                        <Button
                                            x:Name="UpdateDrAndDiagnosisForPCLRequest"
                                            Width="110"
                                            Content="{Binding K1649_G1_CNhatBSiCDoan, Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Button}"
                                            Visibility="{Binding IsAllowToUpdateDiagnosis, Converter={StaticResource BooleanToVisibility}}" />
                                        <Button
                                            x:Name="UpdateConsultationAfterCompleteCmd"
                                            Width="150"
                                            Content="{Binding Z2453_G1_CapNhatSauHoanThanhPhieu, Source={StaticResource eHCMSResources}}"
                                            IsEnabled="{Binding mPCL_SuaSauHoanTat, Mode=TwoWay}"
                                            Style="{StaticResource MainFrame.Button}" />
                                    </StackPanel>
                                    <StackPanel
                                        Grid.Column="1"
                                        VerticalAlignment="Center"
                                        Orientation="Horizontal"
                                        Visibility="{Binding IsAppointment, Converter={StaticResource BooleanToVisibility}}">
                                        <!--<Button x:Name="OkCmd" Content="{Binding K3847_G1_DongY, Source={StaticResource eHCMSResources}}" Width="70" Style="{StaticResource MainFrame.Button}"
                                                IsEnabled="{Binding hasItem, Mode=OneWay}" />-->
                                        <Button
                                            x:Name="OkCmd"
                                            Width="70"
                                            Content="{Binding K3847_G1_DongY, Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Button}" />
                                        <Button
                                            x:Name="CancelCmd"
                                            Width="70"
                                            Content="{Binding K1305_G1_BoQua, Source={StaticResource eHCMSResources}}"
                                            Style="{StaticResource MainFrame.Button}" />
                                    </StackPanel>
                                    <StackPanel
                                        Margin="0,5,0,0"
                                        VerticalAlignment="Center"
                                        Orientation="Horizontal">
                                        <TextBlock VerticalAlignment="Center" Text="{Binding T0788_G1_TaoBoi, StringFormat='{}{0}: ', Source={StaticResource eHCMSResources}}" />
                                        <TextBlock VerticalAlignment="Center" Text="{Binding CurrentPclRequest.StaffIDName, Mode=OneWay}" />
                                    </StackPanel>
                                </StackPanel>

                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </toolkit:BusyIndicator>
        </ContentControl>
    </Grid>
</UserControl>