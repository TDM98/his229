<UserControl
    x:Class="aEMR.Appointment.Views.HealthExaminationRecordView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:AxControls="clr-namespace:aEMR.Controls;assembly=aEMR.Controls"
    xmlns:Converters="clr-namespace:aEMR.Common.Converters;assembly=aEMR.Common"
    xmlns:Resources="clr-namespace:eHCMSLanguage;assembly=aEMRLanguage"
    xmlns:cal="http://www.caliburnproject.org"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="450"
    d:DesignWidth="2100"
    mc:Ignorable="d">
    <UserControl.Resources>
        <Resources:eHCMSResources x:Key="eHCMSResources" />
        <Converters:StringFormatConverter x:Key="StringFormatConverter" />
        <Converters:EnumValueToStringConverter x:Key="EnumValueToStringConverter" />
        <Converters:DecimalConverter x:Key="DecimalConverter" />
        <Converters:DecimalConverter3 x:Key="DecimalConverter3" />
        <Converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        <Converters:ResourceStringConverter x:Key="ResourceStringConverter" />
        <Converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <Converters:BooleanToVisibilityNotConverter x:Key="BooleanToVisibilityNotConverter" />
        <Converters:LongToVisibilityConverter x:Key="LongToVisibilityConverter" />
        <Converters:GenderStringConverter x:Key="GenderStringConverter" />
        <Converters:IntConverter x:Key="IntConverter" />
    </UserControl.Resources>
    <Grid x:Name="LayoutRoot">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <TextBlock
            Grid.Row="0"
            Grid.Column="0"
            Grid.ColumnSpan="6"
            Margin="5"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Style="{StaticResource MainFrame.TextBlock.Bold.14}"
            Text="{Binding TitleForm, ConverterParameter=Upper, Mode=OneWay, Converter={StaticResource StringFormatConverter}}" />
        <TextBlock
            Grid.Row="1"
            Grid.Column="0"
            Margin="5,0"
            VerticalAlignment="Center"
            Style="{StaticResource MainFrame.TextBlock.01}"
            Text="{Binding S0647_G1_SoHD, Source={StaticResource eHCMSResources}}" />
        <TextBox
            Grid.Row="1"
            Grid.Column="1"
            MinWidth="100"
            Margin="0,2"
            IsReadOnly="True"
            Style="{StaticResource MainFrame.TextBox}"
            Text="{Binding CurrentClientContract.ContractNo}" />
        <TextBlock
            Grid.Row="1"
            Grid.Column="2"
            Margin="5,0"
            VerticalAlignment="Center"
            Style="{StaticResource MainFrame.TextBlock.01}"
            Text="{Binding Z2670_G1_TenHopDong, Source={StaticResource eHCMSResources}}" />
        <TextBox
            Grid.Row="1"
            Grid.Column="3"
            MinWidth="100"
            Margin="0,2,150,2"
            Style="{StaticResource MainFrame.TextBox}"
            Text="{Binding CurrentClientContract.ContractName}" />
        <TextBlock
            Grid.Row="1"
            Grid.Column="4"
            Margin="5,0"
            VerticalAlignment="Center"
            Style="{StaticResource MainFrame.TextBlock.01}"
            Text="{Binding N0069_G1_NgHD, Source={StaticResource eHCMSResources}}" />
        <AxControls:AxDateTextBox
            Grid.Row="1"
            Grid.Column="5"
            Width="90"
            Height="22"
            Margin="0,2"
            HorizontalAlignment="Left"
            VerticalAlignment="Center"
            Text="{Binding CurrentClientContract.ContractDate, Mode=TwoWay, NotifyOnValidationError=True, Converter={StaticResource ShortDateConverter}}" />
        <TextBlock
            Grid.Row="2"
            Grid.Column="0"
            Margin="5,0"
            VerticalAlignment="Center"
            Style="{StaticResource MainFrame.TextBlock.01}"
            Text="{Binding T0858_G1_TenKhachHg, Source={StaticResource eHCMSResources}}" />
        <!--<TextBox Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="3" Style="{StaticResource MainFrame.TextBox}" MinWidth="100" IsReadOnly="True" Text="{Binding CurrentClientContract.ContractNo}" Margin="0 2"/>-->
        <AxControls:AxAutoComplete
            x:Name="HosClientComboBox"
            Grid.Row="2"
            Grid.Column="1"
            Grid.ColumnSpan="3"
            MinWidth="400"
            Margin="0,2,150,2"
            cal:Message.Attach="[Event Populating] = [Action HosClient_Populating($source,$eventArgs)];                                    [Event DropDownClosed] = [Action HosClient_DropDownClosed($source,$eventArgs)];                                    [Event Loaded] = [Action HosClientComboBox_Loaded($source,$eventArgs)]"
            FilterMode="None"
            IsDropDownOpen="True"
            ItemContainerStyle="{StaticResource AxAutoCompleteBoxBkg}"
            MinimumPopulateDelay="300"
            MinimumPrefixLength="1"
            Style="{StaticResource AxAutoCompleteMyStyle}"
            Text="{Binding CurrentClientContract.HosClient.ClientName, Mode=OneWay}"
            ValueMemberBinding="{Binding ClientName}"
            ValueMemberPath="HosClientID">
            <AxControls:AxAutoComplete.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            MinWidth="50"
                            Margin="0"
                            Padding="0"
                            Style="{StaticResource MainFrame.TextBlock.01}"
                            Text="{Binding HosClientCode}" />
                        <TextBlock
                            MinWidth="300"
                            Margin="5,0,0,0"
                            Padding="0"
                            Style="{StaticResource MainFrame.TextBlock.01}"
                            Text="{Binding ClientName}" />
                    </StackPanel>
                </DataTemplate>
            </AxControls:AxAutoComplete.ItemTemplate>
        </AxControls:AxAutoComplete>
        <TextBlock
            Grid.Row="2"
            Grid.Column="4"
            Margin="5,0"
            VerticalAlignment="Center"
            Style="{StaticResource MainFrame.TextBlock.01}"
            Text="{Binding T0723_G1_GChu, Source={StaticResource eHCMSResources}}" />
        <TextBox
            Grid.Row="2"
            Grid.Column="5"
            MinWidth="100"
            Margin="0,2"
            Style="{StaticResource MainFrame.TextBox}"
            Text="{Binding CurrentClientContract.ContractDescription}" />
        <TextBlock
            Grid.Row="3"
            Grid.Column="0"
            Margin="5,0"
            VerticalAlignment="Center"
            Style="{StaticResource MainFrame.TextBlock.01}"
            Text="{Binding T2669_G1_Loai, Source={StaticResource eHCMSResources}}" />
        <TextBox
            Grid.Row="3"
            Grid.Column="1"
            Grid.ColumnSpan="3"
            MinWidth="100"
            Margin="0,2,150,2"
            IsReadOnly="True"
            Style="{StaticResource MainFrame.TextBox}"
            Text="{Binding CurrentClientContract.HosClient.HosClientType, Mode=OneWay}" />
        <TextBlock
            Grid.Row="4"
            Grid.Column="0"
            Margin="5,0"
            VerticalAlignment="Center"
            Style="{StaticResource MainFrame.TextBlock.01}"
            Text="{Binding N0076_G1_NgHieuLuc, Source={StaticResource eHCMSResources}}" />
        <StackPanel
            Grid.Row="4"
            Grid.Column="1"
            Grid.ColumnSpan="3"
            Orientation="Horizontal">
            <AxControls:AxDateTextBox
                Width="90"
                Height="22"
                Margin="0,2"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Center"
                Text="{Binding CurrentClientContract.ValidDateFrom, Mode=TwoWay, NotifyOnValidationError=True, Converter={StaticResource ShortDateConverter}}" />
            <AxControls:AxDateTextBox
                Width="90"
                Height="22"
                Margin="5,2"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Center"
                Text="{Binding CurrentClientContract.ValidDateTo, Mode=TwoWay, NotifyOnValidationError=True, Converter={StaticResource ShortDateConverter}}" />
        </StackPanel>
        <TextBlock
            Grid.Row="3"
            Grid.Column="4"
            Margin="5,0"
            VerticalAlignment="Center"
            Style="{StaticResource MainFrame.TextBlock.01}"
            Text="{Binding Z2938_G1_PTMGChoCPPhatSinh, Source={StaticResource eHCMSResources}}" />
        <TextBox
            Grid.Row="3"
            Grid.Column="5"
            MinWidth="100"
            Margin="0,2"
            Style="{StaticResource MainFrame.TextBox}"
            Text="{Binding CurrentClientContract.DiscountPercent, Mode=TwoWay, Converter={StaticResource IntConverter}}" />
        <CheckBox
            Grid.Row="5"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Margin="5,5"
            VerticalAlignment="Center"
            Content="{Binding Z2785_G1_CongTyDYTTPhatSinh, Source={StaticResource eHCMSResources}}"
            IsChecked="{Binding CurrentClientContract.IsPayAddingMoreSvs, Mode=TwoWay}"
            Style="{StaticResource MainFrame.Checkbox.MiddleTitle}" />
        <CheckBox
            Grid.Row="5"
            Grid.Column="2"
            Margin="5,5"
            VerticalAlignment="Center"
            Content="{Binding Z2788_G1_DaHoanTat, Source={StaticResource eHCMSResources}}"
            IsChecked="{Binding CurrentClientContract.IsCompleted, Mode=OneWay}"
            IsEnabled="False"
            Style="{StaticResource MainFrame.Checkbox.MiddleTitle}" />
        <StackPanel
            Grid.Row="5"
            Grid.Column="3"
            Orientation="Horizontal">
            <TextBlock
                VerticalAlignment="Center"
                Style="{StaticResource MainFrame.TextBlock.01}"
                Text="{Binding TotalContractPaidAmount, Converter={StaticResource ResourceStringConverter}, ConverterParameter=Z2789_G1_TongThu0}" />
            <TextBlock
                VerticalAlignment="Center"
                Style="{StaticResource MainFrame.TextBlock.01}"
                Text="{Binding TotalFinalizedAmount, Converter={StaticResource ResourceStringConverter}, ConverterParameter=Z2791_G1_DaThanhToan0, StringFormat='{}, {0}'}"
                Visibility="{Binding TotalFinalizedAmount, Converter={StaticResource LongToVisibilityConverter}}" />
        </StackPanel>
        <TextBlock
            Grid.Row="4"
            Grid.Column="4"
            Margin="5,0"
            VerticalAlignment="Center"
            Style="{StaticResource MainFrame.TextBlock.01}"
            Text="{Binding Z2789_G1_GiaTriHopDong, Source={StaticResource eHCMSResources}}" />
        <TextBox
            Grid.Row="4"
            Grid.Column="5"
            MinWidth="100"
            Margin="0,2"
            IsEnabled="{Binding CurrentClientContract.IsCompletedButNotFinalized, Mode=OneWay}"
            Style="{StaticResource MainFrame.TextBox}"
            Text="{Binding CurrentClientContract.TotalContractAmount, Mode=TwoWay, Converter={StaticResource DecimalConverter}}" />

        <TextBlock
            Grid.Row="5"
            Grid.Column="4"
            Margin="5,0"
            VerticalAlignment="Center"
            Style="{StaticResource MainFrame.TextBlock.01}"
            Text="{Binding Z2912_G1_GiaTriHopDongKSKTamTinh, Source={StaticResource eHCMSResources}}" />
        <TextBox
            Grid.Row="5"
            Grid.Column="5"
            MinWidth="100"
            Margin="0,2"
            IsEnabled="False"
            Style="{StaticResource MainFrame.TextBox}"
            Text="{Binding TotalContractAmountTemp, Mode=TwoWay, Converter={StaticResource DecimalConverter}}" />

        <TabControl
            Grid.Row="6"
            Grid.Column="0"
            Grid.ColumnSpan="6"
            Style="{StaticResource MainFrame.TabControl}">
            <TabItem Header="{Binding G1514_G1_THop, Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TabItem}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <GroupBox
                        Grid.Row="2"
                        Grid.Column="0"
                        Header="{Binding K2931_G1_DSBNKham, Source={StaticResource eHCMSResources}}"
                        Style="{StaticResource MainFrame.GroupBox}">
                        <DataGrid
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            cal:Message.Attach="[Event LoadingRow] = [Action gvPatients_LoadingRow($source, $eventArgs)]                                   ;[Event CurrentCellChanged]=[Action gvPatients_CurrentCellChanged($source,$eventArgs)]"
                            AutoGenerateColumns="False"
                            CanUserAddRows="False"
                            HeadersVisibility="All"
                            HorizontalScrollBarVisibility="Auto"
                            ItemsSource="{Binding PatientCollectionView, Mode=OneWay}"
                            Opacity="5"
                            RowHeaderWidth="50"
                            Style="{StaticResource MainFrame.DataGridStyle}"
                            VerticalScrollBarVisibility="Auto">
                            <DataGrid.Columns>
                                <DataGridTemplateColumn HeaderStyle="{StaticResource MainFrame.DataGridColumnHeaderStyle.01}">
                                    <DataGridTemplateColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <StackPanel HorizontalAlignment="Center">
                                                <CheckBox
                                                    HorizontalAlignment="Center"
                                                    cal:Message.Attach="[Event Checked]=[Action CheckBoxAllPatient_Checked($source,$eventArgs)];                                                           [Event Unchecked]=[Action CheckBoxAllPatient_Checked($source,$eventArgs)]"
                                                    IsThreeState="False"
                                                    ToolTipService.ToolTip="{Binding K2122_G1_ChonTatCa, Source={StaticResource eHCMSResources}}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.HeaderTemplate>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                                <Button
                                                    Grid.Row="1"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    cal:Message.Attach="[Event Click]=[Action PrintPatientItems($datacontext)]"
                                                    Style="{StaticResource MainFrame.HyperlinkButton.01}"
                                                    ToolTipService.ToolTip="{Binding G2521_G1_XemIn, Source={StaticResource eHCMSResources}}">
                                                    <Image
                                                        Width="13"
                                                        Height="13"
                                                        Opacity="1"
                                                        Source="/aEMR.CommonViews;component/Assets/Images/print-icon.png" />
                                                </Button>
                                                <Button
                                                    Grid.Row="1"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    cal:Message.Attach="[Event Click]=[Action PrintPatientResults($datacontext)]"
                                                    Style="{StaticResource MainFrame.HyperlinkButton.01}"
                                                    ToolTipService.ToolTip="{Binding T1905_G1_InCTietL, Source={StaticResource eHCMSResources}}">
                                                    <Image
                                                        Width="13"
                                                        Height="13"
                                                        Opacity="1"
                                                        Source="/aEMR.CommonViews;component/Assets/Images/icon_printer.png" />
                                                </Button>
                                                <Button
                                                    Grid.Row="1"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    cal:Message.Attach="[Event Click]=[Action btnHealthExaminationRecordInfo($datacontext)]"
                                                    Style="{StaticResource MainFrame.HyperlinkButton.01}"
                                                    ToolTipService.ToolTip="{Binding T3816_G1_NhapKetLuan, Source={StaticResource eHCMSResources}}">
                                                    <Image
                                                        Width="13"
                                                        Height="13"
                                                        Opacity="1"
                                                        Source="/aEMR.CommonViews;component/Assets/Images/checklist.png" />
                                                </Button>
                                                <Border
                                                    VerticalAlignment="Stretch"
                                                    BorderThickness="0"
                                                    IsEnabled="{Binding IsProcessed, Converter={StaticResource InverseBoolConverter}}">
                                                    <CheckBox
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        HorizontalContentAlignment="Center"
                                                        cal:Message.Attach="[Event Checked]=[Action CurrentPatient_CheckChanged($source,$eventArgs)];                                                               [Event Unchecked]=[Action CurrentPatient_CheckChanged($source,$eventArgs)]"
                                                        IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        IsEnabled="{Binding IsScheduled, Converter={StaticResource InverseBoolConverter}}" />
                                                </Border>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn
                                    Width="24"
                                    Header=""
                                    IsReadOnly="True">
                                    <DataGridTemplateColumn.HeaderStyle>
                                        <Style BasedOn="{StaticResource MainFrame.DataGridColumnHeaderStyle}" TargetType="DataGridColumnHeader">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="*" />
                                                                <RowDefinition Height="Auto" />
                                                            </Grid.RowDefinitions>
                                                            <Button
                                                                Grid.Row="1"
                                                                Margin="0,0,0,6"
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                cal:Message.Attach="[Event Click]=[Action ClearFilterButton()]"
                                                                Style="{StaticResource MainFrame.HyperlinkButton.01}"
                                                                ToolTipService.ToolTip="{Binding T2535_G1_LamMoi, Source={StaticResource eHCMSResources}}">
                                                                <Image
                                                                    Width="13"
                                                                    Height="13"
                                                                    Opacity="1"
                                                                    Source="/aEMR.CommonViews;component/Assets/Images/refresh16.png" />
                                                            </Button>
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </DataGridTemplateColumn.HeaderStyle>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                cal:Message.Attach="[Event Click]=[Action UpdatePatientItemCmd($datacontext, $eventArgs)]"
                                                Style="{StaticResource MainFrame.HyperlinkButton.01}"
                                                ToolTipService.ToolTip="{Binding K1680_G1_CNhatTTinBN, Source={StaticResource eHCMSResources}}">
                                                <Image
                                                    Width="13"
                                                    Height="13"
                                                    Opacity="1"
                                                    Source="/aEMR.CommonViews;component/Assets/Images/edit-icon.png" />
                                            </Button>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn
                                    Width="24"
                                    Header=""
                                    IsReadOnly="True">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <Button
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    cal:Message.Attach="[Event Click]=[Action RemovePatientItemCmd($datacontext)]"
                                                    Style="{StaticResource MainFrame.HyperlinkButton.01}"
                                                    ToolTipService.ToolTip="{Binding G2617_G1_Xoa, Source={StaticResource eHCMSResources}}"
                                                    Visibility="{Binding IsProcessed, Converter={StaticResource BooleanToVisibilityNotConverter}}">
                                                    <Image
                                                        Width="13"
                                                        Height="13"
                                                        Opacity="1"
                                                        Source="/aEMR.CommonViews;component/Assets/Images/Delete.png" />
                                                </Button>
                                                <Button
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Style="{StaticResource MainFrame.HyperlinkButton.01}"
                                                    Visibility="{Binding IsProcessed, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <Image
                                                        Width="13"
                                                        Height="13"
                                                        Opacity="1"
                                                        Source="/aEMR.CommonViews;component/Assets/Images/tick.png" />
                                                </Button>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn
                                    Width="Auto"
                                    Binding="{Binding PatientObj.PatientCode, Mode=OneWay}"
                                    Header="{Binding T3274_G1_MaBN, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="True" />
                                <DataGridTextColumn
                                    Width="Auto"
                                    Binding="{Binding PatientObj.FullName, Mode=OneWay}"
                                    Header="{Binding T1584_G1_HoTenBN2, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="True">
                                    <DataGridTextColumn.HeaderStyle>
                                        <Style BasedOn="{StaticResource MainFrame.DataGridColumnHeaderStyle}" TargetType="DataGridColumnHeader">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="*" />
                                                                <RowDefinition Height="Auto" />
                                                            </Grid.RowDefinitions>
                                                            <TextBlock
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Text="{Binding T1584_G1_HoTenBN2, Source={StaticResource eHCMSResources}}" />
                                                            <TextBox
                                                                Grid.Row="1"
                                                                MinWidth="200"
                                                                Style="{StaticResource MainFrame.TextBox}"
                                                                Text="{Binding ElementName=LayoutRoot, Path=DataContext.FullNameFilterString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </DataGridTextColumn.HeaderStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn
                                    Width="Auto"
                                    Binding="{Binding PatientObj.Gender, Converter={StaticResource GenderStringConverter}, Mode=OneWay}"
                                    IsReadOnly="True">
                                    <DataGridTextColumn.HeaderStyle>
                                        <Style BasedOn="{StaticResource MainFrame.DataGridColumnHeaderStyle}" TargetType="DataGridColumnHeader">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="*" />
                                                                <RowDefinition Height="Auto" />
                                                            </Grid.RowDefinitions>
                                                            <TextBlock
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Text="{Binding T1223_G1_GTinh, Source={StaticResource eHCMSResources}}" />
                                                            <ComboBox
                                                                Grid.Row="1"
                                                                DisplayMemberPath="Name"
                                                                ItemsSource="{Binding ElementName=LayoutRoot, Path=DataContext.GenderCollection}"
                                                                SelectedValue="{Binding ElementName=LayoutRoot, Path=DataContext.CurrentFilerGender, Mode=TwoWay}"
                                                                SelectedValuePath="ID"
                                                                Style="{StaticResource MainFrame.ComboBox}" />
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </DataGridTextColumn.HeaderStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn
                                    Width="Auto"
                                    Binding="{Binding PatientObj.Age, Mode=OneWay}"
                                    IsReadOnly="True">
                                    <DataGridTextColumn.HeaderStyle>
                                        <Style BasedOn="{StaticResource MainFrame.DataGridColumnHeaderStyle}" TargetType="DataGridColumnHeader">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="*" />
                                                                <RowDefinition Height="Auto" />
                                                            </Grid.RowDefinitions>
                                                            <TextBlock
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Text="{Binding G2057_G1_Tuoi, Source={StaticResource eHCMSResources}}" />
                                                            <StackPanel
                                                                Grid.Row="1"
                                                                Margin="4,0"
                                                                HorizontalAlignment="Center"
                                                                Orientation="Horizontal">
                                                                <TextBox
                                                                    Height="22"
                                                                    MinWidth="30"
                                                                    Padding="0,3,0,0"
                                                                    MaxLength="2"
                                                                    Style="{Binding MainFrame.TextBox}"
                                                                    Text="{Binding ElementName=LayoutRoot, Path=DataContext.FilterAgeFrom, Mode=TwoWay, Converter={StaticResource IntConverter}, UpdateSourceTrigger=LostFocus}"
                                                                    TextAlignment="Center" />
                                                                <TextBlock
                                                                    HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"
                                                                    Text=" - " />
                                                                <TextBox
                                                                    Height="22"
                                                                    MinWidth="30"
                                                                    Padding="0,3,0,0"
                                                                    MaxLength="2"
                                                                    Style="{Binding MainFrame.TextBox}"
                                                                    Text="{Binding ElementName=LayoutRoot, Path=DataContext.FilterAgeTo, Mode=TwoWay, Converter={StaticResource IntConverter}, UpdateSourceTrigger=LostFocus}"
                                                                    TextAlignment="Center" />
                                                            </StackPanel>
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </DataGridTextColumn.HeaderStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn
                                    Width="Auto"
                                    Binding="{Binding PatientGroupString, Mode=OneWay}"
                                    IsReadOnly="True">
                                    <DataGridTextColumn.HeaderStyle>
                                        <Style BasedOn="{StaticResource MainFrame.DataGridColumnHeaderStyle}" TargetType="DataGridColumnHeader">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="*" />
                                                                <RowDefinition Height="Auto" />
                                                            </Grid.RowDefinitions>
                                                            <TextBlock
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Text="{Binding N0239_G1_Nhom, Source={StaticResource eHCMSResources}}" />
                                                            <ComboBox
                                                                Grid.Row="1"
                                                                DisplayMemberPath="HosClientContractPatientGroupName"
                                                                ItemsSource="{Binding ElementName=LayoutRoot, Path=DataContext.PatientGroupCollection}"
                                                                SelectedValue="{Binding ElementName=LayoutRoot, Path=DataContext.CurrentFilerPatientGroupID, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                SelectedValuePath="HosClientContractPatientGroupID"
                                                                Style="{StaticResource MainFrame.ComboBox}" />
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </DataGridTextColumn.HeaderStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn
                                    Width="Auto"
                                    Binding="{Binding ClientClassification, Mode=TwoWay}"
                                    Header="{Binding K2274_G1_CVu, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="False" />
                                <DataGridTextColumn
                                    Width="Auto"
                                    Binding="{Binding ClientGroup, Mode=TwoWay}"
                                    Header="{Binding T2261_G1_KhoaPh, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="False" />
                                <DataGridTextColumn
                                    MinWidth="80"
                                    Binding="{Binding TotalInvoicePrice, Mode=OneWay, Converter={StaticResource DecimalConverter}}"
                                    ElementStyle="{StaticResource RightAligmentTextBlock}"
                                    Header="{Binding T0849_G1_Gia, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="True" />
                                <DataGridTextColumn
                                    MinWidth="80"
                                    Binding="{Binding TotalContractPaidAmount, Mode=OneWay, Converter={StaticResource DecimalConverter}}"
                                    ElementStyle="{StaticResource RightAligmentTextBlock}"
                                    Header="{Binding R0754_G1_TgThu, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="True" />
                                <DataGridCheckBoxColumn
                                    Binding="{Binding IsScheduled, Mode=OneWay}"
                                    Header="{Binding Z2785_G1_DaCoPKB, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="True"
                                    Visibility="Collapsed" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>

                    <GroupBox
                        Grid.Row="2"
                        Grid.Column="1"
                        Header="{Binding K2974_G1_DSDVKB, Source={StaticResource eHCMSResources}}"
                        IsEnabled="{Binding gCurrentPatientRowIndex.IsScheduled, Converter={StaticResource InverseBoolConverter}}"
                        Style="{StaticResource MainFrame.GroupBox}">
                        <DataGrid
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            cal:Message.Attach="[Event LoadingRow] = [Action gvService_LoadingRow($source, $eventArgs)]"
                            AutoGenerateColumns="False"
                            CanUserAddRows="False"
                            HeadersVisibility="All"
                            ItemsSource="{Binding ServiceCollectionView, Mode=OneWay}"
                            ScrollViewer.HorizontalScrollBarVisibility="Auto"
                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                            Style="{StaticResource MainFrame.DataGridStyle}">
                            <DataGrid.Columns>
                                <DataGridTemplateColumn HeaderStyle="{StaticResource MainFrame.DataGridColumnHeaderStyle.01}">
                                    <DataGridTemplateColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <StackPanel HorizontalAlignment="Center">
                                                <CheckBox
                                                    HorizontalAlignment="Center"
                                                    cal:Message.Attach="[Event Checked]=[Action CheckBoxAllServiceItem_Checked($source,$eventArgs)];                                                           [Event Unchecked]=[Action CheckBoxAllServiceItem_Checked($source,$eventArgs)]"
                                                    IsThreeState="False"
                                                    ToolTipService.ToolTip="{Binding K2122_G1_ChonTatCa, Source={StaticResource eHCMSResources}}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.HeaderTemplate>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox
                                                HorizontalAlignment="Center"
                                                HorizontalContentAlignment="Center"
                                                IsChecked="{Binding IsChecked, Mode=TwoWay, UpdateSourceTrigger=LostFocus}"
                                                IsThreeState="False" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn
                                    Width="Auto"
                                    Binding="{Binding MedRegItem.ChargeableItemCode, Mode=OneWay}"
                                    Header="{Binding K2569_G1_Code, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="True" />
                                <DataGridTextColumn
                                    Width="Auto"
                                    Binding="{Binding MedRegItem.ChargeableItemName, Mode=OneWay}"
                                    Header="{Binding K3421_G1_DV, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="True">
                                    <DataGridTextColumn.HeaderStyle>
                                        <Style BasedOn="{StaticResource MainFrame.DataGridColumnHeaderStyle}" TargetType="DataGridColumnHeader">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="*" />
                                                                <RowDefinition Height="Auto" />
                                                            </Grid.RowDefinitions>
                                                            <TextBlock
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Text="{Binding K3421_G1_DV, Source={StaticResource eHCMSResources}}" />
                                                            <TextBox
                                                                Grid.Row="1"
                                                                MinWidth="200"
                                                                Style="{StaticResource MainFrame.TextBox}"
                                                                Text="{Binding ElementName=LayoutRoot, Path=DataContext.ServiceNameFilterString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </DataGridTextColumn.HeaderStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn
                                    Width="Auto"
                                    Binding="{Binding MedRegItem.MedProductType, Mode=OneWay, Converter={StaticResource EnumValueToStringConverter}}"
                                    Header="{Binding T2669_G1_Loai, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="True" />
                                <DataGridTextColumn
                                    Width="40"
                                    Binding="{Binding MedRegItem.Qty, Mode=OneWay, UpdateSourceTrigger=LostFocus, Converter={StaticResource DecimalConverter3}}"
                                    Header="{Binding S0583_G1_SLg, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="True" />
                                <DataGridTextColumn
                                    MinWidth="80"
                                    Binding="{Binding MedRegItem.ChargeableItem.NormalPrice, Mode=OneWay, UpdateSourceTrigger=LostFocus, Converter={StaticResource DecimalConverter}}"
                                    ElementStyle="{StaticResource RightAligmentTextBlock}"
                                    Header="{Binding T0860_G1_GiaBan, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="True" />
                                <DataGridTextColumn
                                    MinWidth="80"
                                    Binding="{Binding MedRegItem.InvoicePrice, Mode=OneWay, UpdateSourceTrigger=LostFocus, Converter={StaticResource DecimalConverter}}"
                                    ElementStyle="{StaticResource RightAligmentTextBlock}"
                                    Header="{Binding T0849_G1_Gia, Source={StaticResource eHCMSResources}}"
                                    IsReadOnly="True" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>
                </Grid>
            </TabItem>
            <TabItem Header="{Binding K1837_G1_CTiet, Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TabItem}">
                <DataGrid
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    AutoGenerateColumns="True"
                    CanUserAddRows="False"
                    CanUserSortColumns="False"
                    IsReadOnly="True"
                    ItemsSource="{Binding SummaryContractTable, Mode=OneWay}"
                    ScrollViewer.HorizontalScrollBarVisibility="Auto"
                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                    Style="{StaticResource MainFrame.DataGridStyle}" />
            </TabItem>
        </TabControl>
        <DataGrid
            Grid.Row="7"
            Grid.Column="0"
            Grid.ColumnSpan="6"
            MinHeight="100"
            Margin="0,5"
            AutoGenerateColumns="False"
            IsReadOnly="True"
            ItemsSource="{Binding CurrentClientContract.ClientContractFinalizationCollection}"
            Style="{StaticResource MainFrame.DataGridStyle}"
            Visibility="{Binding CurrentClientContract.IsHealthyOrganization, Converter={StaticResource BooleanToVisibilityConverter}}">
            <DataGrid.Columns>
                <DataGridTextColumn Binding="{Binding FinalizedReceiptNum}" Header="{Binding S0680_G1_SoPh, Source={StaticResource eHCMSResources}}" />
                <DataGridTextColumn Binding="{Binding DateFinalize, StringFormat='HH:mm dd/MM/yyy'}" Header="{Binding N0102_G1_NgQuyetToan, Source={StaticResource eHCMSResources}}" />
                <DataGridTextColumn
                    Binding="{Binding Amount, StringFormat='#,0'}"
                    ElementStyle="{StaticResource RightAligmentTextBlock}"
                    Header="{Binding R0754_G1_TgThu, Source={StaticResource eHCMSResources}}" />
                <DataGridTextColumn Binding="{Binding Staff.FullName}" Header="{Binding N0203_G1_NhVienThu, Source={StaticResource eHCMSResources}}" />
            </DataGrid.Columns>
        </DataGrid>
        <Grid
            Grid.Row="8"
            Grid.Column="0"
            Grid.ColumnSpan="6"
            Margin="0,5">
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition />
                <RowDefinition />

            </Grid.RowDefinitions>
            <StackPanel
                Grid.Row="0"
                Orientation="Horizontal"
                Visibility="{Binding IsPayment, Converter={StaticResource BooleanToVisibilityNotConverter}}">
                <Button
                    x:Name="btnFindOld"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2670_G1_TimHopDong, Source={StaticResource eHCMSResources}}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnAddListPatient"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2813_G1_ThemDSBN, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsCompleted, Mode=OneWay, Converter={StaticResource InverseBoolConverter}}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnAddPatient"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding G0247_G1_ThemBN, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsCompleted, Mode=OneWay, Converter={StaticResource InverseBoolConverter}}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnAddService"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding G0252_G1_ThemDV, Source={StaticResource eHCMSResources}}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnApplyService"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding K1939_G1_ChonDV, Source={StaticResource eHCMSResources}}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnAddClient"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2670_G1_ThemKhachHang, Source={StaticResource eHCMSResources}}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnSave"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding T2937_G1_Luu, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsCompleted, Mode=OneWay, Converter={StaticResource InverseBoolConverter}}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnConfirmCompleted"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2788_G1_TaoPKB, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsDBSavedButNotCompleted, Mode=OneWay}"
                    Style="{StaticResource MainFrame.Button}"
                    Visibility="Collapsed" />
                <Button
                    x:Name="btnRenew"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding T0795_G1_TaoMoi, Source={StaticResource eHCMSResources}}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnCreateNewToOld"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2136_G1_TaoMoiDuaTrenCu, Source={StaticResource eHCMSResources}}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="GroupPatientButton"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2934_G1_TaoNhom, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsDBSavedButNotCompleted}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="GroupPatientGroupServiceButton"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2935_G1_NhomDVVaoNhom, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsDBSavedButNotCompleted}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="AddPatientToGroupButton"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2936_G1_ThemDSBNVaoNhom, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsDBSavedButNotCompleted}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="DiscountServicePriceButton"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2941_G1_GiamGiaDichVu, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsDBSavedButNotCompleted}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="PrintPatientItemCollection"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding T1927_G1_InPhL, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsDBSaved}"
                    Style="{StaticResource MainFrame.Button}" />
            </StackPanel>
            <StackPanel
                Grid.Row="1"
                Orientation="Horizontal"
                Visibility="{Binding IsPayment, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Button
                    x:Name="btnGetPatientPaidAmount"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2786_G1_LayChiTietDoanhThu, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsActivated, Mode=OneWay}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnCompleteContract"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2787_G1_HoanTatHopDong, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsActivatedButNotCompleted, Mode=OneWay}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnFinalizeContract"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Z2787_G1_ThanhToanHopDong, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsActivatedButNotFinalized, Mode=OneWay}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnConfirmFinalizeContract"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding Q0498_G1_QuyetToan, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsActivatedButNotFinalized, Mode=OneWay}"
                    Style="{StaticResource MainFrame.Button}"
                    Visibility="{Binding CurrentClientContract.IsHealthyOrganization, Converter={StaticResource BooleanToVisibilityConverter}}" />
            </StackPanel>
            <StackPanel Grid.Row="2" Orientation="Horizontal">
                <Button
                    x:Name="btnExportExcel"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding G2849_G1_XuatExcel, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsActivated, Mode=OneWay}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnPrintPreview"
                    MinWidth="80"
                    Margin="2,2"
                    Content="{Binding G2521_G1_XemIn, Source={StaticResource eHCMSResources}}"
                    IsEnabled="{Binding CurrentClientContract.IsActivated, Mode=OneWay}"
                    Style="{StaticResource MainFrame.Button}" />
                <Button
                    x:Name="btnExportResultExcel"
                    MinWidth="80"
                    Margin="2,2"
                    Content="Xuất Excel Kết quả KSK"
                    IsEnabled="{Binding CurrentClientContract.IsActivated, Mode=OneWay}"
                    Style="{StaticResource MainFrame.Button}" />
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
