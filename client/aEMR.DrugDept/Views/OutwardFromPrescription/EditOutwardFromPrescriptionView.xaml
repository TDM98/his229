<UserControl x:Class="eHCMS.DrugDept.Views.EditOutwardFromPrescriptionView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignHeight="400" d:DesignWidth="800"
             xmlns:cal="http://www.caliburnproject.org"
             xmlns:AxControls="clr-namespace:aEMR.Controls;assembly=aEMR.Controls"
             
             xmlns:ed="http://schemas.microsoft.com/expression/2010/drawing" 
                xmlns:toolkit="http://schemas.xceed.com/wpf/xaml/toolkit"
    xmlns:Resources="clr-namespace:eHCMSLanguage;assembly=aEMRLanguage" >
    <UserControl.Resources>
	    <Resources:eHCMSResources x:Key="eHCMSResources"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibility"/>
        <DataTemplate x:Key="ColDeleteTemplate">
            <Button x:Name="lnkDelete" cal:Message.Attach="[Event Click] = [Action lnkDelete_Click($source, $eventArgs)]
                             ;[Event Loaded]=[Action lnkDelete_Loaded($source)]" ToolTipService.ToolTip="{Binding G2617_G1_Xoa, Source={StaticResource eHCMSResources}}"  HorizontalAlignment="Center" VerticalAlignment="Center">
                
                    <Image Source="/aEMR.CommonViews;component/Assets/Images/Delete.png" Height="13" Width="13" Opacity="1" />
                
            </Button>
        </DataTemplate>
        <DataTemplate x:Key="TempThucXuat">
            <TextBlock Text="{Binding OutQuantity,Converter={StaticResource DecimalConverter},UpdateSourceTrigger=PropertyChanged}" TextAlignment="Right" VerticalAlignment="Center" FontWeight="Bold"/>
        </DataTemplate>
        <DataTemplate x:Key="TempEditThucXuat">
            <AxControls:AxTextBox x:Name="tbEDose" Margin="0" Text="{Binding OutQuantity,Mode=TwoWay,Converter={StaticResource DecimalConverter}, UpdateSourceTrigger=PropertyChanged}" TextAlignment="Right" BorderBrush="Transparent" Background="Transparent" FontWeight="Bold" />
        </DataTemplate>
        <DataTemplate x:Key="ColChooseLoTemplate">
            <Button x:Name="lnkChooseBatchNumber" cal:Message.Attach="[Event Click] = [Action lnkChooseBatchNumber_Click($source, $eventArgs)]" ToolTipService.ToolTip="{Binding Z0056_G1_ChonLoKhac, Source={StaticResource eHCMSResources}}" Content="{Binding InBatchNumber,Mode=TwoWay}" CommandParameter="{Binding GetGenMedProductForSell.GenMedProductID}" HorizontalAlignment="Center" VerticalAlignment="Center">
            </Button>
        </DataTemplate>
        <DataTemplate x:Key="AutoCompleteTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBlock Name="txtDrugName" Text="{Binding BrandName}" Style="{StaticResource MainFrame.TextBlock.Auto}" Margin="0" Padding="0" />
                <TextBlock  Text=" - " Style="{StaticResource MainFrame.TextBlock.Auto}" />
                <TextBlock  Text="{Binding Remaining}" Style="{StaticResource MainFrame.TextBlock.Auto}" Margin="0" Padding="0" />
                <TextBlock  Text="{Binding UnitName}" Style="{StaticResource MainFrame.TextBlock.Auto}" Margin="10,0,0,0" Padding="0" />

            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>
    <toolkit:BusyIndicator HorizontalAlignment="Stretch"
                                         VerticalAlignment="Stretch"
                                         IsBusy="{Binding IsLoading, Mode=OneWay}"                                         
                                         DisplayAfter="0:0:0.100"
                                         Margin="0,0,0,10">
        <Grid x:Name="LayoutRoot" Background="White">
            <Grid.RowDefinitions>
                <RowDefinition Height="30"/>
                <RowDefinition Height="25"></RowDefinition>
                <RowDefinition Height="Auto"></RowDefinition>
                <RowDefinition Height="Auto"></RowDefinition>
                <RowDefinition></RowDefinition>
                <RowDefinition Height="auto"></RowDefinition>
                <RowDefinition Height="Auto"></RowDefinition>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition Width="Auto"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock x:Name="TitleForm" Text="{Binding K1016_G1_BanThuocTheoToaCNhatPh, Source={StaticResource eHCMSResources}}" Grid.ColumnSpan="3"
                               HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="#3595CB" 
                               FontSize="14" FontWeight="Bold" />
            <Grid  Grid.ColumnSpan="4" Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"></ColumnDefinition>
                    <ColumnDefinition></ColumnDefinition>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="1" Margin="0,1" Grid.ColumnSpan="3" HorizontalAlignment="Right" Orientation="Horizontal">
                    <TextBlock HorizontalAlignment="Right"
                           Text="{Binding T2144_G1_Kho, StringFormat='{}{0} ', Source={StaticResource eHCMSResources}}"
                           Style="{StaticResource MainFrame.TextBlock.00}"
                           Margin="20,1,1,1"  VerticalAlignment="Center"/>
                    <AxControls:KeyEnabledComboBox  Name="comboBox1" Style="{StaticResource MainFrame.ComboBox}" Margin="1,1,10,1" SelectedValueEx="{Binding StoreID,Mode=TwoWay}" SelectedValuePath="StoreID"  DisplayMemberPath="swhlName" ItemsSource="{Binding StoreCbx}" IsTabStop="True" MinWidth="120" MaxWidth="200"
                                           TabIndex="2" IsEnabled="False" />

                    <TextBlock HorizontalAlignment="Right"
                           Text="{Binding N0194_G1_NhVien, StringFormat='{}{0} :', Source={StaticResource eHCMSResources}}"
                           Style="{StaticResource MainFrame.TextBlock.00}"
                           Margin="1" VerticalAlignment="Center"/>
                    <TextBlock Name="StaffName"
                           Margin="1,1,10,1"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           TextWrapping="NoWrap"
                           Grid.Row="1"
                           Grid.Column="2"
                           Style="{StaticResource MainFrame.TextBlock.00}" />
                </StackPanel>
            </Grid>

            <Border  Width="Auto" Style="{StaticResource LightBlueBorderStyle}" Margin="1" Grid.Row="2" Grid.Column="0">
                <Grid Height="Auto" Width="Auto" ShowGridLines="False" DataContext="{Binding SelectedOutInvoice}" >
                    <Grid.ColumnDefinitions >
                        <ColumnDefinition MinWidth="2"  Width="2"/>
                        <!--0.Full name label-->
                        <ColumnDefinition Width="Auto"/>
                        <!--1.Full name label-->
                        <ColumnDefinition MinWidth="100" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!--0.-->
                        <RowDefinition Height="Auto"/>
                        <!--1.-->
                        <RowDefinition Height="Auto"/>
                        <!--2.-->
                        <RowDefinition Height="Auto"/>
                        <!--3.-->
                        <RowDefinition Height="Auto"/>
                        <!--2.-->
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!--Column 1-->
                    <TextBlock Text="{Binding G0656_G1_TTinPhXuat, StringFormat='{}{0} :', Source={StaticResource eHCMSResources}}" Margin="0,6,1,7" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.ColumnSpan="2" Grid.Row="0" Grid.Column="1" Style="{StaticResource MainFrame.TextBlock.00}" />
                    <TextBlock Text="{Binding G1691_G1_TThai, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="5" Grid.Column="1" Style="{StaticResource MainFrame.TextBlock.01}" />
                    <TextBlock Text="{Binding T3534_G1_MaPhX, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="1" Grid.Column="1" Style="{StaticResource MainFrame.TextBlock.01}"  />
                    <TextBlock Text="{Binding N0130_G1_NgXuat, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="3" Grid.Column="1" Style="{StaticResource MainFrame.TextBlock.01}" />
                    <!--Column 2-->

                    <TextBlock Text="{Binding OutInvID}" x:Name="txtDOBBN"  HorizontalAlignment="Center" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="1"  Grid.Column="2" Style="{StaticResource MainFrame.TextBlock.02}" />
                    <DatePicker x:Name="txtPtCode" Margin="2,1" HorizontalAlignment="Left" VerticalAlignment="Center"  Grid.Row="3"  Grid.Column="2" Style="{StaticResource MainFrame.DatePicker}" cal:Message.Attach="[Event SelectedDateChanged]=[Action dateTimePickerChanged()]" SelectedDate="{Binding OutDate,TargetNullValue=null,Mode=TwoWay}" Grid.ColumnSpan="3"  />
                    <TextBlock Text="{Binding OutDrugInvStatus}"  Grid.Column="2" Grid.Row="5" HorizontalAlignment="Left" VerticalAlignment="Center" Style="{StaticResource MainFrame.TextBlock.00}" ></TextBlock>
                    <Line Grid.ColumnSpan="8" Grid.Column="1" Grid.Row="2" Fill="#FFF4F4F5" Height="1" Stroke="#FFCCCCCC" VerticalAlignment="Top" HorizontalAlignment="Stretch"/>
                    <Line Grid.ColumnSpan="8" Grid.Column="1" Grid.Row="4" Fill="#FFF4F4F5" Height="1" Stroke="#FFCCCCCC" VerticalAlignment="Top" HorizontalAlignment="Stretch"/>
                </Grid>
            </Border>
            <Border Width="Auto" Style="{StaticResource LightBlueBorderStyle}" Margin="1,1,1,1"  Grid.Row="2" Grid.Column="1">
                <Grid Height="Auto" Width="Auto" ShowGridLines="False">
                    <Grid.ColumnDefinitions >
                        <ColumnDefinition MinWidth="2"  Width="2"/>
                        <!--0.Full name label-->
                        <ColumnDefinition  Width="Auto"/>
                        <!--1.Full name label-->
                        <ColumnDefinition MinWidth="100" Width="120*" />
                        <!--2.Full name value-->
                        <ColumnDefinition MinWidth="45" Width="45"/>
                        <!--3.Age name label-->
                        <ColumnDefinition MinWidth="30" Width="60"/>
                        <!--4.Age name value-->
                        <ColumnDefinition Width="Auto"/>
                        <!--5.Gender lable-->
                        <ColumnDefinition MinWidth="100" Width="160*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!--0.-->
                        <RowDefinition Height="Auto"/>
                        <!--1.-->
                        <RowDefinition Height="Auto"/>
                        <!--2.-->
                        <RowDefinition Height="Auto"/>
                        <!--3.-->
                        <RowDefinition Height="Auto"/>
                        <!--2.-->
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <CheckBox Content="{Binding K1287_G1_BNNgTru, Source={StaticResource eHCMSResources}}" Grid.Column="3" Grid.ColumnSpan="3" HorizontalAlignment="Stretch" Name="chkIsOutPt" VerticalAlignment="Center" Style="{StaticResource MainFrame.Checkbox}" Margin="0,6,1,7" Height="16" />
                    <!--Column 1-->
                    <TextBlock Text="{Binding G0525_G1_TTinBN, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.ColumnSpan="2" Grid.Row="0" Grid.Column="1" Style="{StaticResource MainFrame.TextBlock.00}" />
                    <TextBlock Text="{Binding T1567_G1_HoTen, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="1" Grid.Column="1" Style="{StaticResource MainFrame.TextBlock.01}" />
                    <TextBlock Text="{Binding N0107_G1_NgSinh, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="3" Grid.Column="1" Style="{StaticResource MainFrame.TextBlock.01}"  />

                    <!--Column 2-->
                    <TextBlock Text="{Binding PatientInfo.FullName}"  x:Name="txtFullName"  HorizontalAlignment="Left" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="1"  Grid.Column="2" Style="{StaticResource MainFrame.TextBlock.Title}" Grid.ColumnSpan="3" />
                    <TextBlock Text="{Binding PatientInfo.DOBText}" x:Name="txtDOB"  HorizontalAlignment="Center" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="3"  Grid.Column="2" Style="{StaticResource MainFrame.TextBlock.02}" />
                    <TextBlock Text="{Binding PatientInfo.PatientCode}" x:Name="txtPtCodeBN"  HorizontalAlignment="Left" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="3"  Grid.Column="6" Style="{StaticResource MainFrame.TextBlock.02}" Grid.ColumnSpan="3"/>

                    <!--Column 3-->
                    <TextBlock Text="{Binding G2057_G1_Tuoi, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="3" Grid.Column="3" Style="{StaticResource MainFrame.TextBlock.01}" />
                    <TextBlock Text="{Binding K1232_G1_BHTra, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="5" Grid.Column="3" Style="{StaticResource MainFrame.TextBlock.01}" />
                    <TextBlock Text="{Binding ValueQuyenLoiBH,Converter={StaticResource PercentageConverter}}"  HorizontalAlignment="Center" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="5"  Grid.Column="4" Style="{StaticResource MainFrame.TextBlock.02}" Foreground="Red" />
                    <!--Column 4-->
                    <TextBlock Text="{Binding PatientInfo.AgeString}" x:Name="txtAge"  HorizontalAlignment="Center" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="3"  Grid.Column="4" Style="{StaticResource MainFrame.TextBlock.02}" />
                    <!--Column 5-->
                    <TextBlock Text="{Binding T1223_G1_GTinh, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="1" Grid.Column="5" Style="{StaticResource MainFrame.TextBlock.01}" />
                    <TextBlock Text="{Binding S0693_G1_SoTheBHYT, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="5" Grid.Column="1" Style="{StaticResource MainFrame.TextBlock.01}" />
                    <TextBlock Text="{Binding T3230_G1_MaBN, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="3" Grid.Column="5" Style="{StaticResource MainFrame.TextBlock.01}" />
                    <TextBlock Text="{Binding N0072_G1_NgHetHan, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="5" Grid.Column="5" Style="{StaticResource MainFrame.TextBlock.01}" />
                    <!--Column 6-->
                    <TextBlock Text="{Binding PatientInfo.GenderString}" x:Name="txtGender"  HorizontalAlignment="Left" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="1"  Grid.Column="6" Style="{StaticResource MainFrame.TextBlock.02}" />
                    <TextBlock Text="{Binding CurRegistration.HealthInsurance.HICardNo}" x:Name="txtHICardNumber"  HorizontalAlignment="Left" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="5"  Grid.Column="2" Style="{StaticResource MainFrame.TextBlock.02}" />
                    <TextBlock Text="{Binding CurRegistration.HealthInsurance.ValidDateTo,StringFormat='dd/MM/yyyy'}"  HorizontalAlignment="Left" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="5"  Grid.Column="6" Grid.ColumnSpan="3" Style="{StaticResource MainFrame.TextBlock.02}" Foreground="Red"/>

                    <Line Grid.ColumnSpan="8" Grid.Column="1" Grid.Row="2" Fill="#FFF4F4F5" Height="1" Stroke="#FFCCCCCC" VerticalAlignment="Top" HorizontalAlignment="Stretch"/>
                    <Line Grid.ColumnSpan="8" Grid.Column="1" Grid.Row="4" Fill="#FFF4F4F5" Height="1" Stroke="#FFCCCCCC" VerticalAlignment="Top" HorizontalAlignment="Stretch"/>
                </Grid>
            </Border>
            <Border  Width="Auto" Style="{StaticResource LightBlueBorderStyle}" Margin="1,1,1,1" Grid.Row="2" Grid.Column="2">
                <Grid Height="Auto" Width="Auto" ShowGridLines="False" DataContext="{Binding SelectedPrescription}">
                    <Grid.ColumnDefinitions >
                        <ColumnDefinition  Width="2"/>
                        <ColumnDefinition  Width="Auto"/>
                        <ColumnDefinition MinWidth="100" />
                        <ColumnDefinition  Width="2"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!--0.-->
                        <RowDefinition Height="Auto"/>
                        <!--1.-->
                        <RowDefinition Height="Auto"/>
                        <!--2.-->
                        <RowDefinition Height="Auto"/>
                        <!--3.-->
                        <RowDefinition Height="Auto"/>
                        <!--2.-->
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <!--Column 1-->
                    <TextBlock Text="{Binding G0510_G1_TTinBSi, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="2" Style="{StaticResource MainFrame.TextBlock.00}" Margin="0,6,1,7" />
                    <TextBlock Text="{Binding T1567_G1_HoTen, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="1" Grid.Column="1" Style="{StaticResource MainFrame.TextBlock.01}" />
                    <TextBlock Text="{Binding N0103_G1_NgRaToa, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="3" Grid.Column="1" Style="{StaticResource MainFrame.TextBlock.01}"/>
                    <TextBlock Text="{Binding Z0002_G1_MaToaThuoc, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" HorizontalAlignment="Right" VerticalAlignment="Center" Grid.Row="5" Grid.Column="1" Style="{StaticResource MainFrame.TextBlock.01}" />
                    <!--Column 2-->
                    <!--<TextBlock Text="{Binding DiagTrmtItem.PatientServiceRecord.Staff.FullName, Mode=OneWay}"  x:Name="txtDoctorName"  HorizontalAlignment="Left" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="1"  Grid.Column="2" Style="{StaticResource MainFrame.TextBlock.00}" />
                    <TextBlock Text="{Binding DiagTrmtItem.PatientServiceRecord.Staff.SPhoneNumber, Mode=OneWay}" x:Name="txtDrPhoneNumber"  HorizontalAlignment="Left" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="3"  Grid.Column="2" Style="{StaticResource MainFrame.TextBlock.02}" />
    				<Line Grid.ColumnSpan="8" Grid.Column="1" Grid.Row="2" Fill="#FFF4F4F5" Height="1" Stroke="#FFCCCCCC" VerticalAlignment="Top" HorizontalAlignment="Stretch"/>-->

                    <TextBlock Text="{Binding ObjIssuerStaffID.FullName, Mode=OneWay}"  x:Name="txtDoctorName"  HorizontalAlignment="Left" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="1"  Grid.Column="2" Style="{StaticResource MainFrame.TextBlock.00}" />
                    <TextBlock Text="{Binding IssuedDateTime, Mode=OneWay, StringFormat='dd/MM/yyyy HH:mm:ss'}" x:Name="txtIssuedDateTime"  HorizontalAlignment="Left" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="3"  Grid.Column="2" Style="{StaticResource MainFrame.TextBlock.02}" />
                    <TextBlock Text="{Binding IssueID}"  x:Name="txtFullNameBN"  HorizontalAlignment="Left" VerticalAlignment="Center" TextWrapping="NoWrap" Grid.Row="5"  Grid.Column="2" Style="{StaticResource MainFrame.TextBlock.Title}" Grid.ColumnSpan="3" />
                    <Line Grid.ColumnSpan="8" Grid.Column="1" Grid.Row="2" Fill="#FFF4F4F5" Height="1" Stroke="#FFCCCCCC" VerticalAlignment="Top" HorizontalAlignment="Stretch"/>
                    <Line Grid.ColumnSpan="8" Grid.Column="1" Grid.Row="4" Fill="#FFF4F4F5" Height="1" Stroke="#FFCCCCCC" VerticalAlignment="Top" HorizontalAlignment="Stretch"/>

                </Grid>
            </Border>
            <AxControls:AxDataGridNy AutoGenerateColumns="False" Grid.Row="4"
                      Grid.Column="0"
                      Grid.ColumnSpan="7"
                      Name="grdPrescription"
                      
                      HeadersVisibility="All"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      ItemsSource="{Binding SelectedOutInvoice.OutwardDrugMedDepts}"
                      ColumnHeaderStyle="{StaticResource MainFrame.DataGridColumnHeaderStyle}"
                      Style="{StaticResource MainFrame.DataGridStyle}"
                       cal:Message.Attach="[Event LoadingRow] = [Action grdPrescription_LoadingRow($source, $eventArgs)];
                      [Event Loaded] = [Action grdPrescription_Loaded($source, $eventArgs)]; [Event Unloaded] = [Action GridInward_Unloaded($source, $eventArgs)];
                      [Event RowEditEnding] = [Action grdPrescription_RowEditEnding($source, $eventArgs)]" 
                      SelectedItem="{Binding SelectedOutwardDrug,Mode=TwoWay}" CanUserSortColumns="False">
                <DataGrid.Columns>
                    <DataGridTemplateColumn CellTemplate="{StaticResource ColDeleteTemplate}" IsReadOnly="True"/>
                    <DataGridCheckBoxColumn Header="{Binding K1209_G1_BH, Source={StaticResource eHCMSResources}}"
                                            Width="Auto"
                                            Binding="{Binding HI,Mode=OneWay}"
                                            IsReadOnly="True"/>
                  
                    <!--<DataGridTextColumn  Header="{Binding T3649_G1_MaThuoc, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding  GetGenMedProductForSell.DrugCode,Mode=OneWay}"
                                         ElementStyle="{StaticResource MainFrame.TextBlockCenterAlign}"
                                         IsReadOnly="True" />-->
                    <DataGridTextColumn  Header="{Binding T0904_G1_TenThuoc, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding  GetGenMedProductForSell.BrandName,Mode=OneWay}"
                                         ElementStyle="{StaticResource MainFrame.TextBlockLeftAlign}"
                                         IsReadOnly="True"/>

                    <DataGridTextColumn  Header="{Binding T1316_G1_HLg, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding GetGenMedProductForSell.Content}"
                                         ElementStyle="{StaticResource MainFrame.TextBlockCenterAlign}"
                                         IsReadOnly="True"/>

                    <DataGridTextColumn  Header="{Binding K3966_G1_Dvt, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding GetGenMedProductForSell.UnitName}"
                                         ElementStyle="{StaticResource MainFrame.TextBlockCenterAlign}"
                                         IsReadOnly="True"/>

                    <!--<DataGridTextColumn  Header="{Binding K1503_G1_CachDung, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding GetGenMedProductForSell.Administration}"
                                         ElementStyle="{StaticResource MainFrame.TextBlockCenterAlign}"
                                         IsReadOnly="True" />-->
                    <DataGridTextColumn  Header="{Binding S0620_G1_SLgYC, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding RequestQty,Mode=TwoWay,Converter={StaticResource DecimalConverter}}"
                                         ElementStyle="{StaticResource MainFrame.TextBlockRightAlign}"
                                         IsReadOnly="True"/>

                    <DataGridTemplateColumn Header="{Binding G0771_G1_ThucXuat, Source={StaticResource eHCMSResources}}" CellTemplate="{StaticResource TempThucXuat}" CellEditingTemplate="{StaticResource TempEditThucXuat}"/>

                    <!--<DataGridTextColumn  Header="{Binding G0771_G1_ThucXuat, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding OutQuantity,Mode=TwoWay,Converter={StaticResource DecimalConverter}}"
                                         ElementStyle="{StaticResource MainFrame.TextBlockRightAlign}" FontWeight="Bold"></DataGridTextColumn>-->
                    <DataGridTemplateColumn Header="{Binding T2628_G1_LoSX, Source={StaticResource eHCMSResources}}" CellEditingTemplate="{StaticResource ColChooseLoTemplate}" IsReadOnly="True"/>

                    <DataGridTextColumn  Header="{Binding K3642_G1_DGiaBan, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding OutPrice,Mode=TwoWay,Converter={StaticResource DecimalConverter}}"
                                         IsReadOnly="True"
                                         ElementStyle="{StaticResource MainFrame.TextBlockRightAlign}"/>

                    <DataGridTextColumn  Header="{Binding K3647_G1_DGiaBH, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding ChargeableItem.HIAllowedPrice,Mode=OneWay,Converter={StaticResource DecimalConverter}}"
                                         IsReadOnly="True"
                                         ElementStyle="{StaticResource MainFrame.TextBlockRightAlign}"/>

                    <DataGridTextColumn  Header="{Binding T2576_G1_LechGia, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding PriceDifference,Mode=OneWay,Converter={StaticResource DecimalConverter}}"
                                         IsReadOnly="True"
                                         ElementStyle="{StaticResource MainFrame.TextBlockRightAlign}"/>

                    <DataGridTextColumn  Header="{Binding G0085_G1_TTien, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding TotalPrice,Mode=OneWay,Converter={StaticResource DecimalConverter}}"
                                         IsReadOnly="True"
                                         ElementStyle="{StaticResource MainFrame.TextBlockRightAlign}"/>

                    <DataGridTextColumn  Header="{Binding K1232_G1_BHTra, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding TotalHIPayment,Mode=OneWay,Converter={StaticResource DecimalConverter}}"
                                         IsReadOnly="True"
                                         ElementStyle="{StaticResource MainFrame.TextBlockRightAlign}"/>

                    <DataGridTextColumn  Header="{Binding T2090_G1_KHTra, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding TotalPatientPayment,Mode=OneWay,Converter={StaticResource DecimalConverter}}"
                                         IsReadOnly="True"
                                         ElementStyle="{StaticResource MainFrame.TextBlockRightAlign}"/>

                    <DataGridTextColumn  Header="{Binding T1363_G1_HDung, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding InExpiryDate,Mode=OneWay,StringFormat='dd/MM/yyyy'}"
                                         IsReadOnly="True"
                                         ElementStyle="{StaticResource MainFrame.TextBlockCenterAlign}"/>

                    <DataGridTextColumn  Header="{Binding G2209_G1_ViTri, Source={StaticResource eHCMSResources}}"
                                         Binding="{Binding SdlDescription,Mode=OneWay}"
                                         IsReadOnly="True"
                                         ElementStyle="{StaticResource MainFrame.TextBlockCenterAlign}"/>
                  
                </DataGrid.Columns>
            </AxControls:AxDataGridNy>
            <Border Margin="2" Style="{StaticResource LightBlueBorderStyle}" Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3">
                <AxControls:AxGrid Visibility="{Binding mBanThuocTheoToa_SuaToaThuoc,Converter={StaticResource BooleanToVisibility} }">
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                        <ColumnDefinition Width="80*" MaxWidth="100"></ColumnDefinition>
                        <ColumnDefinition Width="240*"></ColumnDefinition>
                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                        <ColumnDefinition Width="60*" MaxWidth="120"></ColumnDefinition>
                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                        <ColumnDefinition Width="80*" MaxWidth="120"></ColumnDefinition>
                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                        <ColumnDefinition Width="60*" MaxWidth="120"></ColumnDefinition>
                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <StackPanel Orientation="Horizontal" Grid.ColumnSpan="10">
                        <TextBlock Margin="5,2,2,2"  HorizontalAlignment="Left" VerticalAlignment="Center" Text="{Binding N0062_G1_NgDung, StringFormat='{}{0} ', Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TextBlock.01}"/>
                        <AxControls:AxTextBox Text="{Binding strNgayDung,Mode=TwoWay}" Margin="2,1" Style="{StaticResource MainFrame.TextBox}" TextAlignment="Right" TabIndex="98989" Width="60"></AxControls:AxTextBox>
                        <Button Name="btnNgayDung_New" Content="{Binding O0303_G1_OK, Source={StaticResource eHCMSResources}}" Grid.Column="2" Margin="2,1"   Width="Auto" TabIndex="989898" />
                        <Border Margin="1" Style="{StaticResource LightBlueBorderStyle}">
                            <StackPanel Orientation="Horizontal">
                                <RadioButton GroupName="rdtDMBH" Content="{Binding T0822_G1_TatCa, Source={StaticResource eHCMSResources}}" IsChecked="True" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="2" cal:Message.Attach="[Event Checked] = [Action RadioButton1_Checked($source, $eventArgs)]"></RadioButton>
                                <RadioButton GroupName="rdtDMBH" Content="{Binding G0864_G1_ThuocDMBH, Source={StaticResource eHCMSResources}}" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="2" cal:Message.Attach="[Event Checked] = [Action RadioButton2_Checked($source, $eventArgs)]"></RadioButton>
                                <RadioButton GroupName="rdtDMBH" Content="{Binding N0143_G1_NgoaiDMBH, Source={StaticResource eHCMSResources}}" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="2" cal:Message.Attach="[Event Checked] = [Action RadioButton3_Checked($source, $eventArgs)]"></RadioButton>
                            </StackPanel>
                        </Border>
                        
                        <TextBlock Margin="5,2,2,2"  HorizontalAlignment="Left" VerticalAlignment="Center" Text="{Binding Z0029_G1_DauGachDung, Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TextBlock.01}"/>
                        <TextBlock Margin="5,2,2,2"  HorizontalAlignment="Left" VerticalAlignment="Center" Text="{Binding P0344_G1_PhanLoai, StringFormat='{}{0}: ', Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TextBlock.01}"/>
                        <TextBlock Margin="2,2,2,2"  HorizontalAlignment="Left" VerticalAlignment="Center" Text="{Binding SelectedOutInvoice.CategoryName,Mode=OneWay}" Style="{StaticResource MainFrame.TextBlock.01}" Foreground="Red"/>
                        <TextBlock Margin="5,2,2,2"  HorizontalAlignment="Left" VerticalAlignment="Center" Text="{Binding Z0029_G1_DauGachDung, Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TextBlock.01}"/>

                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Grid.Row="1">
                        <TextBlock Margin="2,1" Text="{Binding K2170_G1_ChonThuoc, StringFormat='{}{0}:', Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TextBlock.02}"></TextBlock>
                        <RadioButton Content="{Binding K2569_G1_Code, Source={StaticResource eHCMSResources}}" Margin="2,1" GroupName="ChooseDrug"  cal:Message.Attach="[Event Checked]=[Action Code_Checked($source,$eventArgs)]" ></RadioButton>
                        <RadioButton Content="{Binding T0829_G1_Ten, Source={StaticResource eHCMSResources}}" Margin="2,1" GroupName="ChooseDrug" IsChecked="True"  cal:Message.Attach="[Event Checked]=[Action Name_Checked($source,$eventArgs)]"></RadioButton>
                    </StackPanel>
                    <AxControls:AxTextBox Grid.Row="1" Grid.Column="1" Margin="2,1" Style="{StaticResource MainFrame.TextBox}" Text="{Binding SelectedSellVisitor.Code,Mode=TwoWay}" cal:Message.Attach="[Event LostFocus] = [Action AxTextBox_LostFocus($source, $eventArgs)];[Event Loaded] = [Action AxTextBox_Loaded($source, $eventArgs)]"
                                                   IsEnabled="{Binding VisibilityCode,Mode=OneWay}"/>
                    <AxControls:AxAutoComplete Grid.Row="1" Text="{Binding SelectedSellVisitor.BrandName}"  Name="AutoDrug_Text" Grid.Column="2" Margin="2,1" IsTabStop="False" ValueMemberBinding="{Binding BrandName, Mode=TwoWay}"   
                                                cal:Message.Attach="[Event Populating] = [Action AutoCompleteBox_Populating($source, $eventArgs)];[Event DropDownClosed] = [Action AutoDrug_Text_DropDownClosed($source, $eventArgs)]
                                               ;[Event Loaded] = [Action AutoDrug_Text_Loaded($source, $eventArgs)]"
                                               TextBoxStyle="{StaticResource MainFrame.TextBox}" FontWeight="Bold"
                                               IsEnabled="{Binding VisibilityName,Mode=OneWay}" SelectedItem="{Binding SelectedSellVisitor,Mode=TwoWay}"
                                               Style="{StaticResource AxAutoCompleteMyStyle}"  ItemTemplate="{StaticResource AutoCompleteTemplate}"
                                               ItemContainerStyle="{StaticResource AxAutoCompleteBoxBkg}"
                                               >
                    </AxControls:AxAutoComplete>
                    <TextBlock Grid.Row="1" Margin="2,1" Grid.Column="3"   HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding S0612_G1_SLgXuat, Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TextBlock.01}"/>
                    <AxControls:AxTextBox Grid.Row="1" Grid.Column="4" Margin="2,1" Style="{StaticResource MainFrame.TextBox}" TextAlignment="Right" Text="{Binding SelectedSellVisitor.RequiredNumber,Mode=TwoWay}" IsEnabled="{Binding SelectedOutwardInfo.CanSaveAndPaidPrescript,Mode=OneWay}"></AxControls:AxTextBox>

                    <TextBlock Grid.Row="1" Margin="2,1" Grid.Column="5"   HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding K3966_G1_Dvt, Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TextBlock.01}"/>
                    <TextBox Grid.Row="1" Grid.Column="6" Margin="2,1" Style="{StaticResource MainFrame.TextBox}" Text="{Binding SelectedSellVisitor.UnitName,Mode=OneWay}" IsEnabled="False"></TextBox>
                    <TextBlock Grid.Row="1" Margin="2,1" Grid.Column="7"   HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding S0610_G1_SLgTon, Source={StaticResource eHCMSResources}}" Style="{StaticResource MainFrame.TextBlock.01}"/>
                    <AxControls:AxTextBox Grid.Row="1" Grid.Column="8" Margin="2,1" Style="{StaticResource MainFrame.TextBox}" TextAlignment="Right" Text="{Binding SelectedSellVisitor.Remaining,Converter={StaticResource DecimalConverter}}" IsEnabled="False"></AxControls:AxTextBox>
                  
                    <Button Content="{Binding G0156_G1_Them, Source={StaticResource eHCMSResources}}" Grid.Row="1" Grid.Column="9" Margin="2,1" HorizontalAlignment="Left" Name="AddItem" VerticalAlignment="Center" Width="75" Style="{StaticResource MainFrame.Button}" IsEnabled="{Binding SelectedOutwardInfo.CanSaveAndPaidPrescript,Mode=OneWay}"/>
                </AxControls:AxGrid>
            </Border>
            <Border  Grid.Row="5" Grid.ColumnSpan="10"
                Width="Auto"
                Style="{StaticResource LightBlueBorderStyle}"
                Margin="1,1,1,1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                        <ColumnDefinition></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column="0" Margin="1,0" Name="btnUp">
                        <Image Source="/aEMR.CommonViews;component/Assets/Images/up_256.png" Height="32" Width="32" Opacity="1" HorizontalAlignment="Left" ToolTipService.ToolTip="Di chuyển lên trên" Margin="2,1" />
                    </Button>
                    <Button  Grid.Column="1" Margin="1,0" Name="btnDown">
                        <Image Source="/aEMR.CommonViews;component/Assets/Images/down_256.png" Height="32" Width="32" Opacity="1" HorizontalAlignment="Left" ToolTipService.ToolTip="Di chuyển xuống dưới" Margin="2,1" />
                    </Button>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Grid.Column="2">
                        <!--colunm 1-->
                        <TextBlock Text="{Binding G1559_G1_TgTien, StringFormat='{}(1) {0} :', Source={StaticResource eHCMSResources}}"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           Margin="5,2"
                           Style="{StaticResource MainFrame.TextBlock.00}" />
                        <TextBlock 
                           Text="{Binding TotalInvoicePrice,Converter={StaticResource DecimalConverter}}"
                           TextAlignment="Right" VerticalAlignment="Center" FontWeight="Bold"
                           Margin="5,2"></TextBlock>
                        <TextBlock Text="{Binding K1232_G1_BHTra, StringFormat='{}(2) {0} :', Source={StaticResource eHCMSResources}}"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           Margin="5,2"
                           Style="{StaticResource MainFrame.TextBlock.00}" />
                        <TextBlock 
                           Text="{Binding TotalHIPayment,Converter={StaticResource DecimalConverter}}"
                           TextAlignment="Right" VerticalAlignment="Center" FontWeight="Bold"
                           Margin="5,2"></TextBlock>
                        <TextBlock Text="{Binding T2090_G1_KHTra, StringFormat='{}(3) {0} :', Source={StaticResource eHCMSResources}}"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           Margin="5,2"
                           Style="{StaticResource MainFrame.TextBlock.00}" />
                        <TextBlock 
                           Text="{Binding TotalPatientPayment,Converter={StaticResource DecimalConverter}}"
                           TextAlignment="Right" VerticalAlignment="Center" FontWeight="Bold" Foreground="Red"
                           Margin="5,2"></TextBlock>
                    </StackPanel>
                </Grid>
            </Border>
            <StackPanel Orientation="Horizontal" Grid.Row="6" Grid.ColumnSpan="10" HorizontalAlignment="Right">

                <Button x:Name="btnSaveMoney" Grid.Column="6" HorizontalAlignment="Left"  VerticalAlignment="Bottom"  Style="{StaticResource MainFrame.Button}" Content="{Binding T2937_G1_Luu, Source={StaticResource eHCMSResources}}" Width="75" Margin="2,1" TabIndex="9"  IsEnabled="{Binding IsOther}"
                  ClickMode="Hover" cal:Message.Attach="[Event MouseLeftButtonDown] = [Action btnClick_MouseLeftButtonDown($source, $eventArgs)]" />
                <!--Visibility="{Binding bLuuTinhTien,Converter={StaticResource BooleanToVisibility} }"-->
                <Button Name="btnNew"
                Content="{Binding K1305_G1_BoQua, Source={StaticResource eHCMSResources}}"
                Margin="2"
                VerticalAlignment="Bottom"
                Width="75"
                Style="{StaticResource MainFrame.Button}"
                Grid.ColumnSpan="4"
                TabIndex="12"/>
            </StackPanel>

            <StackPanel Grid.Row="6" Grid.Column="0"></StackPanel>

            <!-- ePrescription Footer -->
        </Grid>
    </toolkit:BusyIndicator>
</UserControl>
